<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potion API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
        }
        
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .language-switcher select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <label for="language-select">Language:</label>
        <select id="language-select" onchange="switchLanguage()">
            <option value="en">English</option>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        </select>
    </div>

    <h1 id="page-title">üß™ Potion API Test</h1>

    <div class="test-section">
        <h2 id="test1-title">Test 1: Simple Potion Generation</h2>
        <button id="test1-button" onclick="testSimpleGeneration()">Generate 1 Potion</button>
        <div id="result1"></div>
    </div>

    <div class="test-section">
        <h2 id="test2-title">Test 2: Generation with Parameters</h2>
        <button id="test2-button" onclick="testGenerationWithParams()">Generate 2 Potions</button>
        <div id="result2"></div>
    </div>

    <div class="test-section">
        <h2 id="test3-title">Test 3: Error Handling</h2>
        <button id="test3-button" onclick="testErrorHandling()">Test Error Handling</button>
        <div id="result3"></div>
    </div>

    <script>
        // Language translations
        const translations = {
            en: {
                'page-title': 'üß™ Potion API Test',
                'test1-title': 'Test 1: Simple Potion Generation',
                'test1-button': 'Generate 1 Potion',
                'test2-title': 'Test 2: Generation with Parameters',
                'test2-button': 'Generate 2 Potions',
                'test3-title': 'Test 3: Error Handling',
                'test3-button': 'Test Error Handling',
                'testing': 'Testing...',
                'success': 'Success! Generated potions:',
                'error': 'Error:',
                'network-error': 'Network error:'
            },
            ru: {
                'page-title': 'üß™ –¢–µ—Å—Ç API –∑–µ–ª–∏–π',
                'test1-title': '–¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–µ–ª–∏–π',
                'test1-button': '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 1 –∑–µ–ª—å–µ',
                'test2-title': '–¢–µ—Å—Ç 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏',
                'test2-button': '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 2 –∑–µ–ª—å—è',
                'test3-title': '–¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫',
                'test3-button': '–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫',
                'testing': '–¢–µ—Å—Ç–∏—Ä—É–µ–º...',
                'success': '–£—Å–ø–µ—à–Ω–æ! –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∑–µ–ª–∏–π:',
                'error': '–û—à–∏–±–∫–∞:',
                'network-error': '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:'
            }
        };

        let currentLanguage = 'en';

        // Initialize language
        async function initLanguage() {
            try {
                const response = await fetch('api/language-switch.php');
                const data = await response.json();
                if (data.success) {
                    currentLanguage = data.current_language;
                    document.getElementById('language-select').value = currentLanguage;
                    updateUI();
                }
            } catch (error) {
                console.error('Failed to get current language:', error);
            }
        }

        // Switch language
        async function switchLanguage() {
            const newLanguage = document.getElementById('language-select').value;
            try {
                const response = await fetch('api/language-switch.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        language: newLanguage
                    })
                });
                const data = await response.json();
                if (data.success) {
                    currentLanguage = newLanguage;
                    updateUI();
                }
            } catch (error) {
                console.error('Failed to switch language:', error);
            }
        }

        // Update UI with current language
        function updateUI() {
            const t = translations[currentLanguage];
            document.getElementById('page-title').textContent = t['page-title'];
            document.getElementById('test1-title').textContent = t['test1-title'];
            document.getElementById('test1-button').textContent = t['test1-button'];
            document.getElementById('test2-title').textContent = t['test2-title'];
            document.getElementById('test2-button').textContent = t['test2-button'];
            document.getElementById('test3-title').textContent = t['test3-title'];
            document.getElementById('test3-button').textContent = t['test3-button'];
        }

        async function testSimpleGeneration() {
            const resultDiv = document.getElementById('result1');
            const t = translations[currentLanguage];
            resultDiv.innerHTML = `<div class="result">${t['testing']}</div>`;

            try {
                const response = await fetch('api/generate-potions.php?action=random&count=1');
                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ ${t['success']} ${data.count}
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            ‚ùå ${t['error']} ${data.error}
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ‚ùå ${t['network-error']} ${error.message}
                    </div>
                `;
            }
        }

        async function testGenerationWithParams() {
            const resultDiv = document.getElementById('result2');
            const t = translations[currentLanguage];
            resultDiv.innerHTML = `<div class="result">${t['testing']}</div>`;

            try {
                const response = await fetch('api/generate-potions.php?action=random&count=2&rarity=Uncommon');
                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ ${t['success']} ${data.count}
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            ‚ùå ${t['error']} ${data.error}
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ‚ùå ${t['network-error']} ${error.message}
                    </div>
                `;
            }
        }

        async function testErrorHandling() {
            const resultDiv = document.getElementById('result3');
            const t = translations[currentLanguage];
            resultDiv.innerHTML = `<div class="result">${t['testing']}</div>`;

            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
                const response = await fetch('api/generate-potions.php?action=random&count=999');
                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ ${t['success']} (unexpected for count=999)
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ Error handled correctly: ${data.error}
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        ‚ùå ${t['network-error']} ${error.message}
                    </div>
                `;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initLanguage();
        });
    </script>
</body>

</html>