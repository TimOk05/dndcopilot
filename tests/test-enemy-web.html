<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .loading {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßô‚Äç‚ôÇÔ∏è –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</h1>
        
        <form id="enemyForm">
            <div class="form-group">
                <label for="threat_level">–£—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã:</label>
                <select id="threat_level" name="threat_level" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã</option>
                    <option value="easy">üü¢ –õ–µ–≥–∫–∏–π (CR 0-3)</option>
                    <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π (CR 1-7)</option>
                    <option value="hard">üü† –°–ª–æ–∂–Ω—ã–π (CR 5-12)</option>
                    <option value="deadly">üî¥ –°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π (CR 10-20)</option>
                    <option value="random">üé≤ –°–ª—É—á–∞–π–Ω—ã–π</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤:</label>
                <input type="number" id="count" name="count" min="1" max="10" value="1" required>
            </div>
            
            <div class="form-group">
                <label for="enemy_type">–¢–∏–ø –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤:</label>
                <select id="enemy_type" name="enemy_type">
                    <option value="">–õ—é–±–æ–π —Ç–∏–ø</option>
                    <option value="humanoid">–ì—É–º–∞–Ω–æ–∏–¥—ã</option>
                    <option value="beast">–ó–≤–µ—Ä–∏</option>
                    <option value="undead">–ù–µ–∂–∏—Ç—å</option>
                    <option value="giant">–í–µ–ª–∏–∫–∞–Ω—ã</option>
                    <option value="dragon">–î—Ä–∞–∫–æ–Ω—ã</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="environment">–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è:</label>
                <select id="environment" name="environment">
                    <option value="">–õ—é–±–∞—è —Å—Ä–µ–¥–∞</option>
                    <option value="arctic">–ê—Ä–∫—Ç–∏–∫–∞</option>
                    <option value="coastal">–ü–æ–±–µ—Ä–µ–∂—å–µ</option>
                    <option value="desert">–ü—É—Å—Ç—ã–Ω—è</option>
                    <option value="forest">–õ–µ—Å</option>
                    <option value="grassland">–†–∞–≤–Ω–∏–Ω—ã</option>
                    <option value="hill">–•–æ–ª–º—ã</option>
                    <option value="mountain">–ì–æ—Ä—ã</option>
                    <option value="swamp">–ë–æ–ª–æ—Ç–∞</option>
                    <option value="underdark">–ü–æ–¥–∑–µ–º–µ–ª—å–µ</option>
                    <option value="urban">–ì–æ—Ä–æ–¥</option>
                </select>
            </div>
            
            <button type="submit" id="submitBtn">
                üé≤ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤
            </button>
        </form>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        document.getElementById('enemyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('result');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            submitBtn.innerHTML = '‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...';
            submitBtn.disabled = true;
            resultDiv.innerHTML = '–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤...';
            resultDiv.className = 'result loading';
            resultDiv.style.display = 'block';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            fetch('api/generate-enemies.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('API Response:', data);
                
                if (data.success && data.enemies) {
                    let resultHtml = '<h3>‚úÖ –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã!</h3>\n\n';
                    
                    data.enemies.forEach((enemy, index) => {
                        resultHtml += `--- –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ ${index + 1} ---\n`;
                        resultHtml += `–ò–º—è: ${enemy.name}\n`;
                        resultHtml += `–¢–∏–ø: ${enemy.type}\n`;
                        resultHtml += `CR: ${enemy.challenge_rating}\n`;
                        resultHtml += `HP: ${enemy.hit_points}\n`;
                        resultHtml += `AC: ${enemy.armor_class}\n`;
                        resultHtml += `–°–∫–æ—Ä–æ—Å—Ç—å: ${enemy.speed}\n`;
                        resultHtml += `–°—Ä–µ–¥–∞: ${enemy.environment}\n`;
                        
                        if (enemy.abilities && Object.keys(enemy.abilities).length > 0) {
                            resultHtml += '–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:\n';
                            Object.entries(enemy.abilities).forEach(([key, value]) => {
                                if (typeof value === 'object' && value.value) {
                                    resultHtml += `  ${key}: ${value.value} (${value.modifier >= 0 ? '+' : ''}${value.modifier})\n`;
                                } else if (typeof value === 'number') {
                                    const mod = Math.floor((value - 10) / 2);
                                    resultHtml += `  ${key}: ${value} (${mod >= 0 ? '+' : ''}${mod})\n`;
                                }
                            });
                        }
                        
                        if (enemy.actions && enemy.actions.length > 0) {
                            resultHtml += `–î–µ–π—Å—Ç–≤–∏—è: ${enemy.actions.join(', ')}\n`;
                        }
                        
                        if (enemy.special_abilities && enemy.special_abilities.length > 0) {
                            resultHtml += `–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: ${enemy.special_abilities.join(', ')}\n`;
                        }
                        
                        if (enemy.description) {
                            resultHtml += `–û–ø–∏—Å–∞–Ω–∏–µ: ${enemy.description}\n`;
                        }
                        
                        if (enemy.tactics) {
                            resultHtml += `–¢–∞–∫—Ç–∏–∫–∞: ${enemy.tactics}\n`;
                        }
                        
                        resultHtml += '\n';
                    });
                    
                    resultDiv.innerHTML = resultHtml;
                    resultDiv.className = 'result success';
                } else {
                    let errorMsg = data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    if (data.message) {
                        errorMsg = data.message;
                    }
                    resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${errorMsg}`;
                    resultDiv.className = 'result error';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                let errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
                
                if (error.message.includes('HTTP')) {
                    errorMessage = `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${error.message}`;
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = '–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.';
                }
                
                resultDiv.innerHTML = `‚ùå ${errorMessage}`;
                resultDiv.className = 'result error';
            })
            .finally(() => {
                submitBtn.innerHTML = 'üé≤ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤';
                submitBtn.disabled = false;
            });
        });
    </script>
</body>
</html>
