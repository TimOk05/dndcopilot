# Руководство по безопасности DnD Copilot

## Настройка безопасности

### 1. Переменные окружения

Создайте файл `.env` в корне проекта:

```bash
# API ключи
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Настройки приложения
DEBUG_MODE=false
ENVIRONMENT=production

# Настройки безопасности
SESSION_LIFETIME=28800
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_TIME=900
PASSWORD_MIN_LENGTH=8
```

### 2. Права доступа к файлам

Убедитесь, что следующие файлы недоступны через веб:

- `.env` - содержит API ключи
- `users.json` - содержит данные пользователей
- `login_attempts.json` - содержит попытки входа
- `registration_attempts.json` - содержит попытки регистрации
- `suspicious_ips.json` - содержит заблокированные IP
- `config.php` - содержит конфигурацию

### 3. Настройки сервера

#### Apache (.htaccess)
Файл `.htaccess` уже настроен для защиты конфиденциальных файлов.

#### Nginx
Добавьте в конфигурацию:

```nginx
location ~ /\.env {
    deny all;
}

location ~ /(users|login_attempts)\.json {
    deny all;
}

location ~ /config\.php {
    deny all;
}
```

### 4. Проверка безопасности

#### Регулярные проверки:
- [ ] Проверка логов на подозрительную активность
- [ ] Обновление API ключей
- [ ] Проверка прав доступа к файлам
- [ ] Мониторинг попыток входа

#### Логи безопасности:
- Все попытки входа записываются в `logs/app.log`
- Неудачные попытки блокируют IP на 15 минут
- После 5 неудачных попыток IP блокируется
- Максимум 1 регистрация в день с одного IP адреса
- Максимум 100 пользователей в системе
- Подозрительная активность блокируется на 24 часа
- Поддержка OAuth через Google для безопасной авторизации

### 5. Рекомендации

1. **Используйте HTTPS** в продакшене
2. **Регулярно обновляйте пароли** пользователей
3. **Мониторьте логи** на подозрительную активность
4. **Ограничьте доступ** к API только авторизованным пользователям
5. **Используйте сложные пароли** (минимум 8 символов)

### 6. Восстановление после атаки

1. Смените все API ключи
2. Проверьте логи на компрометацию
3. Сбросьте пароли всех пользователей
4. Проверьте целостность файлов
5. Обновите систему безопасности

## Контакты для безопасности

При обнаружении уязвимостей обращайтесь к администратору системы.
