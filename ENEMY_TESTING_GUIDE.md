# Руководство по тестированию генератора противников

## Проблема
В локальном PHP окружении отсутствуют расширения `curl` и `openssl`, что не позволяет работать с HTTPS API D&D 5e.

## Решение
Запускать тестирование на сервере, где доступны все необходимые расширения PHP.

## Инструкции для тестирования

### 1. Запуск тестов на сервере

Откройте в браузере или выполните через curl:

```
http://ваш-сервер/dnd/public/api/enemy-monitor.php?action=test
```

Это запустит полный набор тестов с разными уровнями сложности:
- Легкий уровень (CR 0-3)
- Средний уровень (CR 1-4) 
- Сложный уровень (CR 2-6)
- Смертельный уровень (CR 5-12)
- Конкретный CR 1
- Конкретный CR 5
- Конкретный CR 10

### 2. Получение результатов

После запуска тестов, получите результаты:

**Статистика:**
```
http://ваш-сервер/dnd/public/api/enemy-monitor.php?action=stats
```

**Последние логи:**
```
http://ваш-сервер/dnd/public/api/enemy-monitor.php?action=logs&limit=50
```

**Детали последней генерации:**
```
http://ваш-сервер/dnd/public/api/enemy-monitor.php?action=last
```

### 3. Анализ результатов

Ищите следующие проблемы:

1. **Ошибки с конкретными уровнями сложности** - какие CR диапазоны не работают
2. **Проблемы с фильтрацией монстров** - находит ли система подходящих монстров
3. **Ошибки API** - проблемы с получением данных от D&D 5e API
4. **Проблемы с парсингом CR** - корректно ли обрабатываются дробные CR (1/4, 1/2, etc.)

### 4. Локальный мониторинг

Используйте скрипт `get_enemy_info.php` для получения информации с сервера:

```bash
php get_enemy_info.php
```

(Не забудьте изменить `$server_url` в скрипте на реальный URL вашего сервера)

### 5. Ожидаемые проблемы

Основываясь на коде, возможные проблемы:

1. **CR диапазоны слишком узкие** - система может не находить монстров для некоторых уровней
2. **Проблемы с парсингом дробных CR** - монстры с CR 1/4, 1/2 могут не обрабатываться корректно
3. **Фильтрация по типу/среде** - слишком строгие фильтры могут исключать подходящих монстров
4. **API ограничения** - D&D 5e API может иметь ограничения на количество запросов

### 6. Файлы для анализа

После тестирования проверьте:
- `data/logs/enemy_monitor.log` - детальные логи генерации
- `data/logs/app.log` - общие логи приложения
- `data/cache/dnd_api/` - кэшированные данные API

## Следующие шаги

После получения результатов тестирования с сервера, мы сможем:
1. Определить конкретные проблемы с уровнями сложности
2. Исправить логику фильтрации монстров
3. Улучшить обработку CR значений
4. Оптимизировать работу с API
