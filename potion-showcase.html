<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–µ–ª–∏–π D&D - –ü–æ–∏—Å–∫ –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-item {
            display: flex;
            flex-direction: column;
        }
        
        .control-item label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #4ecdc4;
        }
        
        .control-item input,
        .control-item select {
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
        }
        
        .control-item input:focus,
        .control-item select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.3);
        }
        
        .search-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .generate-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        
        .search-btn {
            background: linear-gradient(45deg, #45b7d1, #9c27b0);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        
        .generate-btn:hover,
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .generate-btn:active,
        .search-btn:active {
            transform: translateY(0);
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .potion-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .potion-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--rarity-color);
        }
        
        .potion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .potion-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .potion-icon {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .potion-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4ecdc4;
            flex: 1;
        }
        
        .potion-rarity {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--rarity-color);
            color: white;
        }
        
        .potion-description {
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .potion-effects {
            margin-bottom: 20px;
        }
        
        .effects-title {
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        .effects-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .effect-tag {
            padding: 4px 8px;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            font-size: 0.7rem;
            color: #ff6b6b;
        }
        
        .potion-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .detail-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 600;
            color: #4ecdc4;
        }
        
        .potion-properties {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .property-tag {
            padding: 4px 8px;
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 12px;
            font-size: 0.7rem;
            color: #4ecdc4;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #4ecdc4;
        }
        
        .error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .stats-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        .stat-label {
            opacity: 0.8;
        }
        
        .search-results-info {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .control-group {
                grid-template-columns: 1fr;
            }
            .results {
                grid-template-columns: 1fr;
            }
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üß™ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–µ–ª–∏–π D&D</h1>
            <p>–ü–æ–∏—Å–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∑–µ–ª–∏–π –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º</p>
        </div>

        <div class="stats-section">
            <h2 style="text-align: center; margin-bottom: 20px; color: #4ecdc4;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–µ–ª–∏–π</h2>
            <div id="statsContent" class="stats-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
        </div>

        <div class="controls">
            <div class="search-section">
                <input type="text" id="searchQuery" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –∑–µ–ª–∏–π –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é...">
                <div class="button-group">
                    <button class="search-btn" onclick="searchPotions()">
                        üîç –ù–∞–π—Ç–∏ –∑–µ–ª—å—è
                    </button>
                    <button class="generate-btn" onclick="generatePotions()">
                        üß™ –°–æ–∑–¥–∞—Ç—å –∑–µ–ª—å—è
                    </button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-item">
                    <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–µ–ª–∏–π</label>
                    <input type="number" id="count" value="3" min="1" max="10">
                </div>

                <div class="control-item">
                    <label for="rarity">–†–µ–¥–∫–æ—Å—Ç—å</label>
                    <select id="rarity">
                        <option value="">–õ—é–±–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å</option>
                        <option value="common">–û–±—ã—á–Ω–æ–µ</option>
                        <option value="uncommon">–ù–µ–æ–±—ã—á–Ω–æ–µ</option>
                        <option value="rare">–†–µ–¥–∫–æ–µ</option>
                        <option value="very rare">–û—á–µ–Ω—å —Ä–µ–¥–∫–æ–µ</option>
                        <option value="legendary">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ</option>
                    </select>
                </div>

                <div class="control-item">
                    <label for="type">–¢–∏–ø –∑–µ–ª—å—è</label>
                    <select id="type">
                        <option value="">–õ—é–±–æ–π —Ç–∏–ø</option>
                        <option value="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ">ü©π –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</option>
                        <option value="–£—Å–∏–ª–µ–Ω–∏–µ">üí™ –£—Å–∏–ª–µ–Ω–∏–µ</option>
                        <option value="–ó–∞—â–∏—Ç–∞">üõ°Ô∏è –ó–∞—â–∏—Ç–∞</option>
                        <option value="–ò–ª–ª—é–∑–∏—è">üëÅÔ∏è –ò–ª–ª—é–∑–∏—è</option>
                        <option value="–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è">üîÑ –¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è</option>
                        <option value="–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è">üíÄ –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è</option>
                        <option value="–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ">üîÆ –ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ</option>
                        <option value="–≠–≤–æ–∫–∞—Ü–∏—è">‚ö° –≠–≤–æ–∫–∞—Ü–∏—è</option>
                    </select>
                </div>

                <div class="control-item">
                    <label for="effect">–≠—Ñ—Ñ–µ–∫—Ç</label>
                    <select id="effect">
                        <option value="">–õ—é–±–æ–π —ç—Ñ—Ñ–µ–∫—Ç</option>
                        <option value="heal">Heal - –õ–µ—á–µ–Ω–∏–µ</option>
                        <option value="damage">Damage - –£—Ä–æ–Ω</option>
                        <option value="advantage">Advantage - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</option>
                        <option value="resistance">Resistance - –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ</option>
                        <option value="invisible">Invisible - –ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å</option>
                        <option value="fly">Fly - –ü–æ–ª–µ—Ç</option>
                        <option value="strength">Strength - –°–∏–ª–∞</option>
                        <option value="poison">Poison - –Ø–¥</option>
                        <option value="fire">Fire - –û–≥–æ–Ω—å</option>
                        <option value="cold">Cold - –•–æ–ª–æ–¥</option>
                        <option value="lightning">Lightning - –ú–æ–ª–Ω–∏—è</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="searchResultsInfo" class="search-results-info" style="display: none;">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ -->
        </div>

        <div id="results" class="results">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
        });

        async function loadStats() {
            try {
                const response = await fetch('api/generate-potions.php?action=stats');
                const data = await response.json();

                if (data.success) {
                    displayStats(data.data);
                } else {
                    document.getElementById('statsContent').innerHTML =
                        `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('statsContent').innerHTML =
                    `<div class="error">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        function displayStats(stats) {
            const statsContent = document.getElementById('statsContent');

            let html = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total_potions}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–µ–ª–∏–π</div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
            Object.entries(stats.rarity_distribution).forEach(([rarity, count]) => {
                html += `
                    <div class="stat-card">
                        <div class="stat-number">${count}</div>
                        <div class="stat-label">${rarity}</div>
                    </div>
                `;
            });

            statsContent.innerHTML = html;
        }

        async function generatePotions() {
            const count = document.getElementById('count').value;
            const rarity = document.getElementById('rarity').value;
            const type = document.getElementById('type').value;
            const effect = document.getElementById('effect').value;

            const resultsDiv = document.getElementById('results');
            const searchInfo = document.getElementById('searchResultsInfo');

            searchInfo.style.display = 'none';
            resultsDiv.innerHTML = '<div class="loading">–°–æ–∑–¥–∞–Ω–∏–µ –∑–µ–ª–∏–π...</div>';

            try {
                const params = new URLSearchParams();
                params.append('action', 'random');
                params.append('count', count);
                if (rarity) params.append('rarity', rarity);
                if (type) params.append('type', type);
                if (effect) params.append('effect', effect);

                const response = await fetch(`api/generate-potions.php?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    displayPotions(data.data);
                } else {
                    resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        async function searchPotions() {
            const query = document.getElementById('searchQuery').value.trim();
            const rarity = document.getElementById('rarity').value;
            const type = document.getElementById('type').value;
            const effect = document.getElementById('effect').value;

            if (!query && !rarity && !type && !effect) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã');
                return;
            }

            const resultsDiv = document.getElementById('results');
            const searchInfo = document.getElementById('searchResultsInfo');

            resultsDiv.innerHTML = '<div class="loading">–ü–æ–∏—Å–∫ –∑–µ–ª–∏–π...</div>';

            try {
                const params = new URLSearchParams();
                params.append('action', 'search');
                if (query) params.append('query', query);
                if (rarity) params.append('rarity', rarity);
                if (type) params.append('type', type);
                if (effect) params.append('effect', effect);

                const response = await fetch(`api/generate-potions.php?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    if (data.total_found > 0) {
                        searchInfo.innerHTML = `–ù–∞–π–¥–µ–Ω–æ ${data.total_found} –∑–µ–ª–∏–π, –ø–æ–∫–∞–∑–∞–Ω–æ ${data.count}`;
                        searchInfo.style.display = 'block';
                    } else {
                        searchInfo.style.display = 'none';
                    }
                    displayPotions(data.data);
                } else {
                    searchInfo.style.display = 'none';
                    resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                searchInfo.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        function displayPotions(potions) {
            const resultsDiv = document.getElementById('results');

            if (potions.length === 0) {
                resultsDiv.innerHTML = '<div class="error">–ó–µ–ª—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            let html = '';

            potions.forEach(potion => {
                        const rarityColor = potion.color;

                        html += `
                    <div class="potion-card" style="--rarity-color: ${rarityColor}">
                        <div class="potion-header">
                            <div class="potion-icon">${potion.icon}</div>
                            <div class="potion-name">${potion.name}</div>
                            <div class="potion-rarity">${potion.rarity}</div>
                        </div>
                        
                        <div class="potion-description">${potion.description}</div>
                        
                        ${potion.effects && potion.effects.length > 0 ? `
                            <div class="potion-effects">
                                <div class="effects-title">–≠—Ñ—Ñ–µ–∫—Ç—ã:</div>
                                <div class="effects-list">
                                    ${potion.effects.map(effect => `<span class="effect-tag">${effect}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="potion-details">
                            <div class="detail-item">
                                <div class="detail-label">–¢–∏–ø</div>
                                <div class="detail-value">${potion.type}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                <div class="detail-value">${potion.value}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">–í–µ—Å</div>
                                <div class="detail-value">${potion.weight}</div>
                            </div>
                        </div>
                        
                        <div class="potion-properties">
                            ${potion.properties.map(prop => `<span class="property-tag">${prop}</span>`).join('')}
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–∏—Å–∫–µ
        document.getElementById('searchQuery').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPotions();
            }
        });
    </script>
</body>

</html>