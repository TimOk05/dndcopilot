<?php
/**
 * –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–µ–ª–∏–π D&D
 */

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    exit(0);
}

// –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
try {
    $action = $_GET['action'] ?? 'test';
    
    switch ($action) {
        case 'test':
            $result = ['message' => 'API —Ä–∞–±–æ—Ç–∞–µ—Ç'];
            break;
            
        case 'rarities':
            $result = ['common', 'uncommon', 'rare', 'very rare', 'legendary'];
            break;
            
        case 'types':
            $result = ['–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '–£—Å–∏–ª–µ–Ω–∏–µ', '–ó–∞—â–∏—Ç–∞', '–ò–ª–ª—é–∑–∏—è', '–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è', '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è', '–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ'];
            break;
            
        case 'stats':
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–µ–ª—å—è–º
            $all_potions = [
                ['rarity' => 'Common', 'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Common', 'type' => '–£—Å–∏–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Common', 'type' => '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è'],
                ['rarity' => 'Uncommon', 'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Uncommon', 'type' => '–£—Å–∏–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Uncommon', 'type' => '–ó–∞—â–∏—Ç–∞'],
                ['rarity' => 'Uncommon', 'type' => '–ò–ª–ª—é–∑–∏—è'],
                ['rarity' => 'Rare', 'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Rare', 'type' => '–£—Å–∏–ª–µ–Ω–∏–µ'],
                ['rarity' => 'Rare', 'type' => '–ó–∞—â–∏—Ç–∞'],
                ['rarity' => 'Rare', 'type' => '–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è'],
                ['rarity' => 'Rare', 'type' => '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è'],
                ['rarity' => 'Rare', 'type' => '–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ'],
                ['rarity' => 'Very Rare', 'type' => '–ò–ª–ª—é–∑–∏—è'],
                ['rarity' => 'Very Rare', 'type' => '–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è'],
                ['rarity' => 'Very Rare', 'type' => '–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ'],
                ['rarity' => 'Legendary', 'type' => '–ó–∞—â–∏—Ç–∞'],
                ['rarity' => 'Legendary', 'type' => '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è']
            ];
            
            $rarity_stats = [];
            $type_stats = [];
            
            foreach ($all_potions as $potion) {
                $rarity = $potion['rarity'];
                $type = $potion['type'];
                
                $rarity_stats[$rarity] = ($rarity_stats[$rarity] ?? 0) + 1;
                $type_stats[$type] = ($type_stats[$type] ?? 0) + 1;
            }
            
            $result = [
                'total_potions' => count($all_potions),
                'rarity_distribution' => $rarity_stats,
                'type_distribution' => $type_stats,
                'rarities' => array_keys($rarity_stats),
                'types' => array_keys($type_stats)
            ];
            break;
            
        case 'random':
            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–µ–ª–∏–π
            $potions = [
                // –ó–µ–ª—å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                [
                    'name' => '–ó–µ–ª—å–µ –ª–µ—á–µ–Ω–∏—è',
                    'description' => '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 2d4+2 –æ—á–∫–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è. –ü—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Ç–µ–ø–ª–æ, —Ä–∞–∑–ª–∏–≤–∞—é—â–µ–µ—Å—è –ø–æ —Ç–µ–ª—É.',
                    'rarity' => 'Common',
                    'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ',
                    'icon' => 'ü©π',
                    'color' => '#9b9b9b',
                    'value' => '50 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Common']
                ],
                [
                    'name' => '–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ –ª–µ—á–µ–Ω–∏—è',
                    'description' => '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 4d4+4 –æ—á–∫–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è. –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ–±—ã—á–Ω–æ–≥–æ –∑–µ–ª—å—è –ª–µ—á–µ–Ω–∏—è.',
                    'rarity' => 'Uncommon',
                    'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ',
                    'icon' => 'ü©π',
                    'color' => '#4caf50',
                    'value' => '150 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Uncommon']
                ],
                [
                    'name' => '–í–µ—Ä—Ö–æ–≤–Ω–æ–µ –∑–µ–ª—å–µ –ª–µ—á–µ–Ω–∏—è',
                    'description' => '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 8d4+8 –æ—á–∫–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è. –û–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö –∑–µ–ª–∏–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.',
                    'rarity' => 'Rare',
                    'type' => '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ',
                    'icon' => 'ü©π',
                    'color' => '#2196f3',
                    'value' => '500 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Rare']
                ],
                
                // –ó–µ–ª—å—è —É—Å–∏–ª–µ–Ω–∏—è
                [
                    'name' => '–ó–µ–ª—å–µ —Å–∏–ª—ã',
                    'description' => '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∏–ª—É –Ω–∞ 1d4+1 –Ω–∞ 1 —á–∞—Å. –í–∞—à–∏ –º—ã—à—Ü—ã –Ω–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π —Å–∏–ª–æ–π.',
                    'rarity' => 'Common',
                    'type' => '–£—Å–∏–ª–µ–Ω–∏–µ',
                    'icon' => 'üí™',
                    'color' => '#9b9b9b',
                    'value' => '75 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Common']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –ª–æ–≤–∫–æ—Å—Ç–∏',
                    'description' => '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ª–æ–≤–∫–æ—Å—Ç—å –Ω–∞ 1d4+1 –Ω–∞ 1 —á–∞—Å. –í—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–æ–≤–æ—Ä–Ω—ã–º.',
                    'rarity' => 'Common',
                    'type' => '–£—Å–∏–ª–µ–Ω–∏–µ',
                    'icon' => 'üí™',
                    'color' => '#9b9b9b',
                    'value' => '75 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Common']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –≥–µ—Ä–æ–∏–∑–º–∞',
                    'description' => '–î–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—á–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞ —Å–ø–∞—Å–±—Ä–æ—Å–∫–∏ –æ—Ç —Å—Ç—Ä–∞—Ö–∞.',
                    'rarity' => 'Rare',
                    'type' => '–£—Å–∏–ª–µ–Ω–∏–µ',
                    'icon' => 'üí™',
                    'color' => '#2196f3',
                    'value' => '400 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Rare']
                ],
                
                // –ó–µ–ª—å—è –∑–∞—â–∏—Ç—ã
                [
                    'name' => '–ó–µ–ª—å–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è',
                    'description' => '–î–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É —Ç–∏–ø—É —É—Ä–æ–Ω–∞ –Ω–∞ 1 —á–∞—Å. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏.',
                    'rarity' => 'Uncommon',
                    'type' => '–ó–∞—â–∏—Ç–∞',
                    'icon' => 'üõ°Ô∏è',
                    'color' => '#4caf50',
                    'value' => '200 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Uncommon']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏',
                    'description' => '–î–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∫–æ –≤—Å–µ–º —Ç–∏–ø–∞–º —É—Ä–æ–Ω–∞ –Ω–∞ 1 –º–∏–Ω—É—Ç—É. –ö—Ä–∞–π–Ω–µ –º–æ—â–Ω–æ–µ –∑–µ–ª—å–µ.',
                    'rarity' => 'Legendary',
                    'type' => '–ó–∞—â–∏—Ç–∞',
                    'icon' => 'üõ°Ô∏è',
                    'color' => '#ff9800',
                    'value' => '5000 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Legendary']
                ],
                
                // –ó–µ–ª—å—è –∏–ª–ª—é–∑–∏–∏
                [
                    'name' => '–ó–µ–ª—å–µ –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç–∏',
                    'description' => '–î–µ–ª–∞–µ—Ç –≤–∞—Å –Ω–µ–≤–∏–¥–∏–º—ã–º –Ω–∞ 1 —á–∞—Å. –î–µ–π—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–∞–µ—Ç –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å.',
                    'rarity' => 'Very Rare',
                    'type' => '–ò–ª–ª—é–∑–∏—è',
                    'icon' => 'üëÅÔ∏è',
                    'color' => '#9c27b0',
                    'value' => '1000 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Very Rare']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏',
                    'description' => '–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫ –Ω–∞ 1 —á–∞—Å.',
                    'rarity' => 'Uncommon',
                    'type' => '–ò–ª–ª—é–∑–∏—è',
                    'icon' => 'üëÅÔ∏è',
                    'color' => '#4caf50',
                    'value' => '150 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Uncommon']
                ],
                
                // –ó–µ–ª—å—è —Ç—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏–∏
                [
                    'name' => '–ó–µ–ª—å–µ –ø–æ–ª–µ—Ç–∞',
                    'description' => '–ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ—Ç–∞—Ç—å —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 60 —Ñ—É—Ç–æ–≤ –Ω–∞ 1 —á–∞—Å.',
                    'rarity' => 'Very Rare',
                    'type' => '–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è',
                    'icon' => 'üîÑ',
                    'color' => '#9c27b0',
                    'value' => '800 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Very Rare']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞',
                    'description' => '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–ª–∏ —É–º–µ–Ω—å—à–∞–µ—Ç –≤–∞—à —Ä–∞–∑–º–µ—Ä –Ω–∞ 1d4+1 –Ω–∞ 1 —á–∞—Å.',
                    'rarity' => 'Rare',
                    'type' => '–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è',
                    'icon' => 'üîÑ',
                    'color' => '#2196f3',
                    'value' => '300 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Rare']
                ],
                
                // –ó–µ–ª—å—è –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∏–∏
                [
                    'name' => '–ó–µ–ª—å–µ —è–¥–∞',
                    'description' => '–ü—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –Ω–∞–Ω–æ—Å–∏—Ç 1d4 —É—Ä–æ–Ω–∞ —è–¥–æ–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ä—É–∂–∏—è.',
                    'rarity' => 'Common',
                    'type' => '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è',
                    'icon' => 'üíÄ',
                    'color' => '#9b9b9b',
                    'value' => '100 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–Ø–¥', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Common']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ —Å–º–µ—Ä—Ç–∏',
                    'description' => '–ö—Ä–∞–π–Ω–µ –æ–ø–∞—Å–Ω–æ–µ –∑–µ–ª—å–µ. –ü—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–∞—Å–±—Ä–æ—Å–æ–∫ –æ—Ç —Å–º–µ—Ä—Ç–∏.',
                    'rarity' => 'Legendary',
                    'type' => '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è',
                    'icon' => 'üíÄ',
                    'color' => '#ff9800',
                    'value' => '10000 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Legendary']
                ],
                
                // –ó–µ–ª—å—è –ø—Ä–æ—Ä–∏—Ü–∞–Ω–∏—è
                [
                    'name' => '–ó–µ–ª—å–µ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è',
                    'description' => '–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å —Å–∫–≤–æ–∑—å –∏–ª–ª—é–∑–∏–∏ –∏ –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å –Ω–∞ 1 —á–∞—Å.',
                    'rarity' => 'Rare',
                    'type' => '–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ',
                    'icon' => 'üîÆ',
                    'color' => '#2196f3',
                    'value' => '350 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Rare']
                ],
                [
                    'name' => '–ó–µ–ª—å–µ –ø—Ä–µ–¥–≤–∏–¥–µ–Ω–∏—è',
                    'description' => '–î–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –∏ —Å–ø–∞—Å–±—Ä–æ—Å–∫–∏ –Ω–∞ 1 —á–∞—Å.',
                    'rarity' => 'Very Rare',
                    'type' => '–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ',
                    'icon' => 'üîÆ',
                    'color' => '#9c27b0',
                    'value' => '750 –∑–æ–ª–æ—Ç—ã—Ö',
                    'weight' => '0.5 —Ñ—É–Ω—Ç–∞',
                    'properties' => ['–ü–∏—Ç—å–µ', '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ', 'Very Rare']
                ]
            ];
            
            $count = min((int)($_GET['count'] ?? 1), count($potions));
            $rarity = $_GET['rarity'] ?? '';
            $type = $_GET['type'] ?? '';
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
            if ($rarity && $rarity !== '') {
                $potions = array_filter($potions, function($potion) use ($rarity) {
                    return strtolower($potion['rarity']) === strtolower($rarity);
                });
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É
            if ($type && $type !== '') {
                $potions = array_filter($potions, function($potion) use ($type) {
                    return $potion['type'] === $type;
                });
            }
            
            // –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤
            $potions = array_values($potions);
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∑–µ–ª—å—è
            if (count($potions) <= $count) {
                $result = $potions;
            } else {
                $result = [];
                $available = array_values($potions);
                
                for ($i = 0; $i < $count; $i++) {
                    $index = array_rand($available);
                    $result[] = $available[$index];
                    unset($available[$index]);
                }
            }
            break;
            
        default:
            throw new Exception('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ');
    }
    
    echo json_encode([
        'success' => true,
        'data' => $result,
        'timestamp' => date('Y-m-d H:i:s')
    ], JSON_UNESCAPED_UNICODE);
    
} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'error' => $e->getMessage(),
        'timestamp' => date('Y-m-d H:i:s')
    ], JSON_UNESCAPED_UNICODE);
}
?>
