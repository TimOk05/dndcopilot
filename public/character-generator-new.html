<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .modal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: #2a2a2a;
            border: 2px solid #4a4a4a;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .generator-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .generator-header h2 {
            color: #4fc3f7;
            font-size: 2em;
            margin: 0 0 10px 0;
        }
        
        .generator-header p {
            color: #aaa;
            margin: 0;
        }
        
        .generator-card {
            background: #333;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 2px solid #555;
        }
        
        .card-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .generator-card h3 {
            color: #80deea;
            font-size: 1.5em;
            margin: 0 0 15px 0;
        }
        
        .generator-card p {
            color: #ccc;
            margin: 0 0 25px 0;
            line-height: 1.6;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #4fc3f7, #80deea);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
        }
        
        .character-result {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #333;
            border-radius: 10px;
            border: 2px solid #555;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .result-header h3 {
            color: #4fc3f7;
            margin: 0;
        }
        
        .regenerate-btn {
            background: #4fc3f7;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        .character-content {
            color: #ccc;
        }
    </style>
</head>

<body>
    <div class="modal-bg">
        <div class="modal">
            <button class="modal-close" onclick="closeModal()">√ó</button>

            <div class="generator-header">
                <h2>üé≠ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π D&D 5e</h2>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</p>
            </div>

            <div class="generator-card">
                <div class="card-icon">üé≤</div>
                <h3>–ü–æ–ª–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å</h3>
                <p>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ã–±–µ—Ä–µ—Ç –≤—Å—ë –∑–∞ –≤–∞—Å: —Ä–∞—Å—É, –∫–ª–∞—Å—Å, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ –∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è</p>
                <button class="generate-btn" onclick="generateCharacter()">
                    <span>‚öîÔ∏è</span>
                    <span>–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</span>
                </button>
            </div>

            <div id="characterResult" class="character-result">
                <div class="result-header">
                    <h3>üé≠ –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –≥–æ—Ç–æ–≤!</h3>
                    <button class="regenerate-btn" onclick="generateCharacter()">üîÑ –°–æ–∑–¥–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ</button>
                </div>
                <div id="characterContent" class="character-content"></div>
            </div>
        </div>
    </div>

    <script>
        function closeModal() {
            window.close();
        }

        function generateCharacter() {
            const btn = document.querySelector('.generate-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>üé≤</span><span>–ì–µ–Ω–µ—Ä–∏—Ä—É—é...</span>';
            btn.disabled = true;

            fetch('api/generate-character.php?action=generate', {
                    method: 'GET'
                })
                .then(response => response.json())
                .then(data => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;

                    if (data && !data.error) {
                        displayCharacter(data);
                    } else {
                        showError('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                });
        }

        function displayCharacter(character) {
            const resultDiv = document.getElementById('characterResult');
            const contentDiv = document.getElementById('characterContent');

            let raceInfo = character.race.name;
            if (character.subrace) {
                raceInfo += ` (${character.subrace.name})`;
            }

            let classInfo = character.class.name;
            if (character.subclass) {
                classInfo += ` (${character.subclass.name})`;
            }

            let html = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #4fc3f7; margin: 0 0 10px 0;">üé≠ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                    <p><strong>–ò–º—è:</strong> ${character.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    <p><strong>–†–∞—Å–∞:</strong> ${raceInfo}</p>
                    <p><strong>–ö–ª–∞—Å—Å:</strong> ${classInfo}</p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${character.level}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #4fc3f7; margin: 0 0 10px 0;">‚öîÔ∏è –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div><strong>–°–∏–ª–∞:</strong> ${character.ability_scores.STR} (${character.ability_modifiers.STR >= 0 ? '+' : ''}${character.ability_modifiers.STR})</div>
                        <div><strong>–õ–æ–≤–∫–æ—Å—Ç—å:</strong> ${character.ability_scores.DEX} (${character.ability_modifiers.DEX >= 0 ? '+' : ''}${character.ability_modifiers.DEX})</div>
                        <div><strong>–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ:</strong> ${character.ability_scores.CON} (${character.ability_modifiers.CON >= 0 ? '+' : ''}${character.ability_modifiers.CON})</div>
                        <div><strong>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç:</strong> ${character.ability_scores.INT} (${character.ability_modifiers.INT >= 0 ? '+' : ''}${character.ability_modifiers.INT})</div>
                        <div><strong>–ú—É–¥—Ä–æ—Å—Ç—å:</strong> ${character.ability_scores.WIS} (${character.ability_modifiers.WIS >= 0 ? '+' : ''}${character.ability_modifiers.WIS})</div>
                        <div><strong>–•–∞—Ä–∏–∑–º–∞:</strong> ${character.ability_scores.CHA} (${character.ability_modifiers.CHA >= 0 ? '+' : ''}${character.ability_modifiers.CHA})</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #4fc3f7; margin: 0 0 10px 0;">üéØ –†–∞—Å–æ–≤—ã–µ —á–µ—Ä—Ç—ã</h4>
                    ${character.traits.map(trait => `
                        <div style="margin-bottom: 10px;">
                            <strong>${trait.name}:</strong> ${trait.description}
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #4fc3f7; margin: 0 0 10px 0;">üó£Ô∏è –Ø–∑—ã–∫–∏</h4>
                    <p>${character.languages.join(', ')}</p>
                </div>
                
                <div>
                    <h4 style="color: #4fc3f7; margin: 0 0 10px 0;">‚öîÔ∏è –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${character.equipment.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            contentDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }
        
        function showError(message) {
            const resultDiv = document.getElementById('characterResult');
            const contentDiv = document.getElementById('characterContent');
            
            contentDiv.innerHTML = `
                <div style="color: #ff4444; text-align: center;">
                    <h4>‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h4>
                    <p>${message}</p>
                </div>
            `;
            
            resultDiv.style.display = 'block';
        }
    </script>
</body>

</html>