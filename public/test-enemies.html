<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ - D&D Copilot</title>
    <link rel="stylesheet" href="assets/css/utilities.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .content {
            padding: 40px;
        }
        
        .test-section {
            margin-bottom: 40px;
        }
        
        .test-section h2 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .form-group select,
        .form-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .enemy-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
        }
        
        .enemy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .enemy-name {
            font-size: 1.5em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .enemy-cr {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .enemy-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .enemy-description {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .test-info {
            background: #e8f4fd;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .test-info h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .test-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .test-info li {
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .enemy-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .header h1 {
                font-size: 2em;
            }
            .content {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üé≤ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</h1>
            <p>D&D Copilot - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</p>
        </div>

        <div class="content">
            <div class="test-info">
                <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</h3>
                <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ:</p>
                <ul>
                    <li>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</li>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ —Ç–∏–ø—É –∏ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏</li>
                    <li>–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ AI-–ø–µ—Ä–µ–≤–æ–¥–∞</li>
                    <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫</li>
                </ul>
            </div>

            <div class="test-section">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="threat_level">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</label>
                        <select id="threat_level" name="threat_level">
                            <option value="easy">–õ–µ–≥–∫–∏–π (CR 1/4 - 1)</option>
                            <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π (CR 2 - 4)</option>
                            <option value="hard">–°–ª–æ–∂–Ω—ã–π (CR 5 - 8)</option>
                            <option value="deadly">–°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π (CR 9+)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</label>
                        <input type="number" id="count" name="count" min="1" max="5" value="1">
                    </div>

                    <div class="form-group">
                        <label for="enemy_type">–¢–∏–ø –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</label>
                        <select id="enemy_type" name="enemy_type">
                            <option value="">–õ—é–±–æ–π —Ç–∏–ø</option>
                            <option value="beast">–ó–≤–µ—Ä—å</option>
                            <option value="humanoid">–ì—É–º–∞–Ω–æ–∏–¥</option>
                            <option value="dragon">–î—Ä–∞–∫–æ–Ω</option>
                            <option value="undead">–ù–µ–∂–∏—Ç—å</option>
                            <option value="fiend">–î–µ–º–æ–Ω</option>
                            <option value="celestial">–ù–µ–±–æ–∂–∏—Ç–µ–ª—å</option>
                            <option value="elemental">–≠–ª–µ–º–µ–Ω—Ç–∞–ª—å</option>
                            <option value="aberration">–ê–±–µ—Ä—Ä–∞—Ü–∏—è</option>
                            <option value="construct">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç</option>
                            <option value="giant">–í–µ–ª–∏–∫–∞–Ω</option>
                            <option value="monstrosity">–ú–æ–Ω—Å—Ç—Ä</option>
                            <option value="ooze">–°–ª–∏–∑—å</option>
                            <option value="plant">–†–∞—Å—Ç–µ–Ω–∏–µ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="environment">–ú–µ—Å—Ç–Ω–æ—Å—Ç—å</label>
                        <select id="environment" name="environment">
                            <option value="">–õ—é–±–∞—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å</option>
                            <option value="arctic">–ê—Ä–∫—Ç–∏–∫–∞</option>
                            <option value="coastal">–ü–æ–±–µ—Ä–µ–∂—å–µ</option>
                            <option value="desert">–ü—É—Å—Ç—ã–Ω—è</option>
                            <option value="forest">–õ–µ—Å</option>
                            <option value="grassland">–†–∞–≤–Ω–∏–Ω—ã</option>
                            <option value="hill">–•–æ–ª–º—ã</option>
                            <option value="mountain">–ì–æ—Ä—ã</option>
                            <option value="swamp">–ë–æ–ª–æ—Ç–æ</option>
                            <option value="underdark">–ü–æ–¥–∑–µ–º—å–µ</option>
                            <option value="underwater">–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä</option>
                            <option value="urban">–ì–æ—Ä–æ–¥</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="use_ai" name="use_ai" checked> 
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –æ–ø–∏—Å–∞–Ω–∏–π
                    </label>
                </div>
            </div>

            <div class="test-section">
                <h2>üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>

                <button class="btn btn-success" onclick="testSingleGeneration()">
                    üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                </button>

                <button class="btn btn-warning" onclick="testAllLevels()">
                    üîÑ –¢–µ—Å—Ç –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π
                </button>

                <button class="btn btn-danger" onclick="testFilters()">
                    üéØ –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤
                </button>

                <button class="btn" onclick="clearResults()">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                </button>
            </div>

            <div id="results" class="results" style="display: none;">
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];

        function showResults() {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('results-content');

            if (testResults.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            resultsDiv.style.display = 'block';

            let html = '';
            testResults.forEach((result, index) => {
                        html += `
                    <div class="enemy-card">
                        <div class="enemy-header">
                            <div class="enemy-name">${result.name}</div>
                            <div class="enemy-cr">CR ${result.challenge_rating}</div>
                        </div>
                        
                        <div class="enemy-stats">
                            <div class="stat-item">
                                <div class="stat-label">–°–∏–ª–∞</div>
                                <div class="stat-value">${result.abilities?.strength || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–õ–æ–≤–∫–æ—Å—Ç—å</div>
                                <div class="stat-value">${result.abilities?.dexterity || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ</div>
                                <div class="stat-value">${result.abilities?.constitution || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div>
                                <div class="stat-value">${result.abilities?.intelligence || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ú—É–¥—Ä–æ—Å—Ç—å</div>
                                <div class="stat-value">${result.abilities?.wisdom || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–•–∞—Ä–∏–∑–º–∞</div>
                                <div class="stat-value">${result.abilities?.charisma || 'N/A'}</div>
                            </div>
                        </div>
                        
                        <div class="enemy-description">
                            <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
                            ${result.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}
                        </div>
                        
                        ${result.tactics ? `
                            <div class="enemy-description">
                                <strong>–¢–∞–∫—Ç–∏–∫–∞:</strong><br>
                                ${result.tactics}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            contentDiv.innerHTML = html;
        }
        
        function clearResults() {
            testResults = [];
            showResults();
        }
        
        async function testSingleGeneration() {
            const params = getFormParams();
            
            try {
                showLoading('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...');
                
                const response = await fetch('api/test-enemies-api.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(params)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    testResults = data.enemies || [];
                    showResults();
                    showSuccess(`–£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${testResults.length} –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤`);
                } else {
                    showError(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`);
            }
        }
        
        async function testAllLevels() {
            const levels = ['easy', 'medium', 'hard', 'deadly'];
            testResults = [];
            
            for (const level of levels) {
                try {
                    showLoading(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è: ${level}...`);
                    
                    const params = getFormParams();
                    params.threat_level = level;
                    params.count = 1;
                    
                    const response = await fetch('api/test-enemies-api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams(params)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.enemies && data.enemies.length > 0) {
                        testResults.push(data.enemies[0]);
                        showSuccess(`‚úÖ –£—Ä–æ–≤–µ–Ω—å ${level}: ${data.enemies[0].name} (CR ${data.enemies[0].challenge_rating})`);
                    } else {
                        showError(`‚ùå –£—Ä–æ–≤–µ–Ω—å ${level}: ${data.error || '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'}`);
                    }
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    showError(`‚ùå –£—Ä–æ–≤–µ–Ω—å ${level}: –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ - ${error.message}`);
                }
            }
            
            showResults();
            showSuccess(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${testResults.length} –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤`);
        }
        
        async function testFilters() {
            const filters = [
                { type: 'beast', environment: 'forest', name: '–õ–µ—Å–Ω–æ–π –∑–≤–µ—Ä—å' },
                { type: 'humanoid', environment: 'urban', name: '–ì–æ—Ä–æ–¥—Å–∫–æ–π –≥—É–º–∞–Ω–æ–∏–¥' },
                { type: 'dragon', environment: 'mountain', name: '–ì–æ—Ä–Ω—ã–π –¥—Ä–∞–∫–æ–Ω' },
                { type: 'undead', environment: 'swamp', name: '–ë–æ–ª–æ—Ç–Ω–∞—è –Ω–µ–∂–∏—Ç—å' }
            ];
            
            testResults = [];
            
            for (const filter of filters) {
                try {
                    showLoading(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞: ${filter.name}...`);
                    
                    const params = getFormParams();
                    params.threat_level = 'medium';
                    params.count = 1;
                    params.enemy_type = filter.type;
                    params.environment = filter.environment;
                    
                    const response = await fetch('api/test-enemies-api.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams(params)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.enemies && data.enemies.length > 0) {
                        testResults.push(data.enemies[0]);
                        showSuccess(`‚úÖ ${filter.name}: ${data.enemies[0].name} (CR ${data.enemies[0].challenge_rating})`);
                    } else {
                        showError(`‚ùå ${filter.name}: ${data.error || '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'}`);
                    }
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    showError(`‚ùå ${filter.name}: –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ - ${error.message}`);
                }
            }
            
            showResults();
            showSuccess(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${testResults.length} –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤`);
        }
        
        function getFormParams() {
            return {
                threat_level: document.getElementById('threat_level').value,
                count: document.getElementById('count').value,
                enemy_type: document.getElementById('enemy_type').value,
                environment: document.getElementById('environment').value,
                use_ai: document.getElementById('use_ai').checked ? 'on' : 'off'
            };
        }
        
        function showLoading(message) {
            const contentDiv = document.getElementById('results-content');
            contentDiv.innerHTML = `<div class="loading">‚è≥ ${message}</div>`;
            document.getElementById('results').style.display = 'block';
        }
        
        function showSuccess(message) {
            const contentDiv = document.getElementById('results-content');
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.innerHTML = `‚úÖ ${message}`;
            contentDiv.appendChild(successDiv);
        }
        
        function showError(message) {
            const contentDiv = document.getElementById('results-content');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `‚ùå ${message}`;
            contentDiv.appendChild(errorDiv);
        }
    </script>
</body>

</html>