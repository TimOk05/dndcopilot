<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#a67c52">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DnD Copilot">
    <title>DnD Copilot - –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">

    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ —Å–±—Ä–æ—Å */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
         :root {
            /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã */
            --header-height: 60px;
            --nav-height: 50px;
            --content-padding: 16px;
            --border-radius: 12px;
            --border-radius-large: 16px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            /* –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
            --font-primary: 'Roboto', system-ui, sans-serif;
            --font-display: 'UnifrakturCook', serif;
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            /* –¢–µ–Ω–∏ */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.2);
            /* Z-index */
            --z-header: 1000;
            --z-nav: 900;
            --z-modal: 1100;
            --z-overlay: 1050;
        }
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        
         :root {
            --bg-primary: #f8f4e8;
            --bg-secondary: #fff9f0;
            --bg-tertiary: #f0e6d0;
            --bg-quaternary: #e8dcc0;
            --text-primary: #2d1b00;
            --text-secondary: #4a2e0a;
            --text-tertiary: #7c4a02;
            --border-primary: #a67c52;
            --border-secondary: #8b6b3a;
            --accent-primary: #a67c52;
            --accent-secondary: #7c4a02;
            --accent-success: #2bb07b;
            --accent-warning: #ffd700;
            --accent-danger: #b71c1c;
            --accent-info: #4a90e2;
            --bg-image: url('backgrounds/light-theme.png');
        }
        /* –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–∞ (–∫–æ—Ä–∏—á–Ω–µ–≤–∞—è) */
        
        [data-theme="medium"] {
            --bg-primary: #2d1810;
            --bg-secondary: #3d2418;
            --bg-tertiary: #4d2a20;
            --bg-quaternary: #5d3028;
            --text-primary: #f0e6d0;
            --text-secondary: #e8dcc0;
            --text-tertiary: #d4c4a0;
            --border-primary: #8b6b3a;
            --border-secondary: #a67c52;
            --accent-primary: #a67c52;
            --accent-secondary: #8b6b3a;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/orange-theme.png');
        }
        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
        
        [data-theme="dark"] {
            --bg-primary: #1a0a0a;
            --bg-secondary: #2a1a1a;
            --bg-tertiary: #3a2a2a;
            --bg-quaternary: #4a3a3a;
            --text-primary: #f0f0f0;
            --text-secondary: #d0d0d0;
            --text-tertiary: #b0b0b0;
            --border-primary: #b71c1c;
            --border-secondary: #d32f2f;
            --accent-primary: #b71c1c;
            --accent-secondary: #d32f2f;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/dark-theme.png');
        }
        /* –ú–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞ */
        
        [data-theme="mystic"] {
            --bg-primary: #1a0a2a;
            --bg-secondary: #2a1a3a;
            --bg-tertiary: #3a2a4a;
            --bg-quaternary: #4a3a5a;
            --text-primary: #f0f0ff;
            --text-secondary: #d0d0ff;
            --text-tertiary: #b0b0ff;
            --border-primary: #7209b7;
            --border-secondary: #8b5cf6;
            --accent-primary: #7209b7;
            --accent-secondary: #8b5cf6;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/mystic-theme.png');
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--bg-image);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: -1;
        }
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-md);
            z-index: var(--z-header);
            box-shadow: var(--shadow-sm);
        }
        
        .logo {
            font-family: var(--font-display);
            font-size: var(--text-xl);
            color: var(--text-tertiary);
            font-weight: 700;
        }
        
        .header-controls {
            display: flex;
            gap: var(--spacing-xs);
        }
        
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius);
            padding: var(--spacing-xs) var(--spacing-sm);
            color: var(--text-primary);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: var(--accent-primary);
            color: var(--bg-secondary);
        }
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--bg-secondary);
            border-top: 2px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: var(--z-nav);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xs);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--text-xs);
            transition: all 0.3s ease;
            border-radius: var(--border-radius);
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .nav-icon {
            font-size: var(--text-lg);
            margin-bottom: 2px;
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        
        .main-content {
            margin-top: var(--header-height);
            margin-bottom: var(--nav-height);
            padding: var(--spacing-md);
            min-height: calc(100vh - var(--header-height) - var(--nav-height));
        }
        /* –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        
        .card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-large);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-md);
        }
        
        .card-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text-tertiary);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }
        /* –ö–Ω–æ–ø–∫–∏ */
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--text-base);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            width: 100%;
            margin-bottom: var(--spacing-sm);
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-primary);
        }
        
        .btn-secondary:hover {
            background: var(--accent-primary);
            color: var(--bg-secondary);
        }
        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        
        .input-group {
            margin-bottom: var(--spacing-md);
        }
        
        .input-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: var(--text-sm);
        }
        
        .input-field {
            width: 100%;
            padding: var(--spacing-sm);
            background: var(--bg-tertiary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: var(--text-base);
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 3px rgba(166, 124, 82, 0.1);
        }
        /* –°–ø–∏—Å–∫–∏ */
        
        .list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .list-item {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--spacing-md);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-large);
            padding: var(--spacing-lg);
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-primary);
        }
        
        .modal-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text-tertiary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: var(--accent-danger);
            color: var(--bg-secondary);
        }
        /* –£—Ç–∏–ª–∏—Ç—ã */
        
        .text-center {
            text-align: center;
        }
        
        .text-left {
            text-align: left;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-sm {
            margin-bottom: var(--spacing-sm);
        }
        
        .mb-md {
            margin-bottom: var(--spacing-md);
        }
        
        .mb-lg {
            margin-bottom: var(--spacing-lg);
        }
        
        .mt-sm {
            margin-top: var(--spacing-sm);
        }
        
        .mt-md {
            margin-top: var(--spacing-md);
        }
        
        .mt-lg {
            margin-top: var(--spacing-lg);
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-in-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        
        @media (max-width: 480px) {
             :root {
                --content-padding: 12px;
                --spacing-lg: 20px;
                --spacing-xl: 28px;
            }
            .card {
                padding: var(--spacing-md);
            }
            .modal-content {
                padding: var(--spacing-md);
            }
        }
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ç–µ–º—ã */
        
        [data-theme="mystic"] .card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-color: var(--accent-primary);
            box-shadow: 0 4px 20px rgba(114, 9, 183, 0.2);
        }
        
        [data-theme="mystic"] .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            box-shadow: 0 2px 10px rgba(114, 9, 183, 0.3);
        }
        
        [data-theme="mystic"] .btn:hover {
            box-shadow: 0 4px 15px rgba(114, 9, 183, 0.4);
        }
    </style>
</head>

<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <header class="header">
        <div class="logo">DnD Copilot</div>
        <div class="header-controls">
            <button class="theme-toggle" onclick="cycleTheme()">üé®</button>

        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <section id="home" class="content-section active">
            <div class="card">
                <h2 class="card-title">üé≤ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ DnD Copilot</h2>
                <p class="text-center mb-md">–í–∞—à –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∏–≥—Ä D&D</p>

                <div class="btn-group">
                    <button class="btn" onclick="showSection('characters')">
                        üë§ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    </button>
                    <button class="btn" onclick="showSection('enemies')">
                        ‚öîÔ∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤
                    </button>
                    <button class="btn" onclick="showSection('potions')">
                        üß™ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–µ–ª–∏–π
                    </button>
                    <button class="btn" onclick="showSection('combat')">
                        üó°Ô∏è –°–∏—Å—Ç–µ–º–∞ –±–æ—è
                    </button>
                    <button class="btn" onclick="showSection('ai-chat')">
                        ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫
                    </button>
                    <button class="btn" onclick="showSection('notes')">
                        üìù –ó–∞–º–µ—Ç–∫–∏
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üéØ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="quick-actions">
                    <button class="btn btn-secondary" onclick="rollDice('1d20')">
                        üé≤ 1d20
                    </button>
                    <button class="btn btn-secondary" onclick="rollDice('2d6')">
                        üé≤ 2d6
                    </button>
                    <button class="btn btn-secondary" onclick="rollDice('1d100')">
                        üé≤ 1d100
                    </button>
                </div>
            </div>
        </section>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π -->
        <section id="characters" class="content-section">
            <div class="card">
                <h2 class="card-title">üë§ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</h2>

                <div class="input-group">
                    <label class="input-label">–†–∞—Å–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
                    <select class="input-field" id="character-race">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                        <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
                        <option value="elf">–≠–ª—å—Ñ</option>
                        <option value="dwarf">–î–≤–∞—Ä—Ñ</option>
                        <option value="halfling">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫</option>
                        <option value="orc">–û—Ä–∫</option>
                        <option value="tiefling">–¢–∏—Ñ–ª–∏–Ω–≥</option>
                        <option value="dragonborn">–î—Ä–∞–∫–æ–Ω–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–π</option>
                        <option value="gnome">–ì–Ω–æ–º</option>
                        <option value="half-elf">–ü–æ–ª—É—ç–ª—å—Ñ</option>
                        <option value="half-orc">–ü–æ–ª—É–æ—Ä–∫</option>
                        <option value="tabaxi">–¢–∞–±–∞–∫—Å–∏</option>
                        <option value="aarakocra">–ê–∞—Ä–∞–∫–æ–∫—Ä–∞</option>
                        <option value="goblin">–ì–æ–±–ª–∏–Ω</option>
                        <option value="kenku">–ö–µ–Ω–∫—É</option>
                        <option value="lizardfolk">–Ø—â–µ—Ä–æ–ª—é–¥</option>
                        <option value="triton">–¢—Ä–∏—Ç–æ–Ω</option>
                        <option value="yuan-ti">–Æ–∞–Ω—å-—Ç–∏</option>
                        <option value="goliath">–ì–æ–ª–∏–∞—Ñ</option>
                        <option value="firbolg">–§–∏—Ä–±–æ–ª–≥</option>
                        <option value="bugbear">–ë–∞–≥–±–∏—Ä</option>
                        <option value="hobgoblin">–•–æ–±–≥–æ–±–ª–∏–Ω</option>
                        <option value="kobold">–ö–æ–±–æ–ª—å–¥</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–ö–ª–∞—Å—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
                    <select class="input-field" id="character-class">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
                        <option value="fighter">–í–æ–∏–Ω</option>
                        <option value="wizard">–í–æ–ª—à–µ–±–Ω–∏–∫</option>
                        <option value="rogue">–ü–ª—É—Ç</option>
                        <option value="cleric">–ñ—Ä–µ—Ü</option>
                        <option value="ranger">–°–ª–µ–¥–æ–ø—ã—Ç</option>
                        <option value="barbarian">–í–∞—Ä–≤–∞—Ä</option>
                        <option value="bard">–ë–∞—Ä–¥</option>
                        <option value="druid">–î—Ä—É–∏–¥</option>
                        <option value="monk">–ú–æ–Ω–∞—Ö</option>
                        <option value="paladin">–ü–∞–ª–∞–¥–∏–Ω</option>
                        <option value="sorcerer">–ß–∞—Ä–æ–¥–µ–π</option>
                        <option value="warlock">–ö–æ–ª–¥—É–Ω</option>
                        <option value="artificer">–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
                    <select class="input-field" id="character-level">
                        <option value="1">1 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="2">2 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="3">3 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="4">4 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="5">5 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="6">6 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="7">7 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="8">8 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="9">9 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="10">10 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="11">11 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="12">12 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="13">13 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="14">14 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="15">15 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="16">16 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="17">17 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="18">18 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="19">19 —É—Ä–æ–≤–µ–Ω—å</option>
                        <option value="20">20 —É—Ä–æ–≤–µ–Ω—å</option>
                    </select>
                </div>

                <button class="btn" onclick="generateCharacter()">
                    üé≤ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                </button>
            </div>

            <div id="character-result" class="card hidden">
                <h3 class="card-title">üë§ –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</h3>
                <div id="character-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('character')">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏
                </button>
            </div>
        </section>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ -->
        <section id="enemies" class="content-section">
            <div class="card">
                <h2 class="card-title">‚öîÔ∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</h2>

                <div class="input-group">
                    <label class="input-label">–£—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã</label>
                    <select class="input-field" id="enemy-threat-level">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã</option>
                        <option value="random">üé≤ –°–ª—É—á–∞–π–Ω—ã–π</option>
                        <option value="easy">üü¢ –õ–µ–≥–∫–∏–π (CR 0-3)</option>
                        <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π (CR 1-7)</option>
                        <option value="hard">üü† –°–ª–æ–∂–Ω—ã–π (CR 5-12)</option>
                        <option value="deadly">üî¥ –°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–π (CR 10-20)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π CR</label>
                    <select class="input-field" id="enemy-cr">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ CR</option>
                        <option value="0">0</option>
                        <option value="0.125">1/8</option>
                        <option value="0.25">1/4</option>
                        <option value="0.5">1/2</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤</label>
                    <input type="number" class="input-field" id="enemy-count" min="1" max="20" value="1">
                </div>

                <div class="input-group">
                    <label class="input-label">–¢–∏–ø –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <input type="text" class="input-field" id="enemy-type" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: dragon, undead, beast">
                </div>

                <div class="input-group">
                    <label class="input-label">–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <select class="input-field" id="enemy-environment">
                        <option value="">–õ—é–±–∞—è —Å—Ä–µ–¥–∞</option>
                        <option value="arctic">–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∞—è</option>
                        <option value="coastal">–ü—Ä–∏–±—Ä–µ–∂–Ω–∞—è</option>
                        <option value="desert">–ü—É—Å—Ç—ã–Ω–Ω–∞—è</option>
                        <option value="forest">–õ–µ—Å–Ω–∞—è</option>
                        <option value="grassland">–†–∞–≤–Ω–∏–Ω–Ω–∞—è</option>
                        <option value="hill">–•–æ–ª–º–∏—Å—Ç–∞—è</option>
                        <option value="mountain">–ì–æ—Ä–Ω–∞—è</option>
                        <option value="swamp">–ë–æ–ª–æ—Ç–Ω–∞—è</option>
                        <option value="underdark">–ü–æ–¥–∑–µ–º–µ–ª—å–µ</option>
                        <option value="urban">–ì–æ—Ä–æ–¥—Å–∫–∞—è</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <input type="checkbox" id="enemy-use-ai" checked>
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∏ —Ç–∞–∫—Ç–∏–∫–∏
                    </label>
                </div>

                <button class="btn" onclick="generateEnemy()">
                    üé≤ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                </button>
            </div>

            <div id="enemy-result" class="card hidden">
                <h3 class="card-title">‚öîÔ∏è –í–∞—à –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫</h3>
                <div id="enemy-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('enemy')">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏
                </button>
            </div>
        </section>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–µ–ª–∏–π -->
        <section id="potions" class="content-section">
            <div class="card">
                <h2 class="card-title">üß™ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–µ–ª–∏–π</h2>

                <div class="input-group">
                    <label class="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–µ–ª–∏–π</label>
                    <input type="number" class="input-field" id="potion-count" min="1" max="10" value="1">
                </div>

                <div class="input-group">
                    <label class="input-label">–†–µ–¥–∫–æ—Å—Ç—å</label>
                    <select class="input-field" id="potion-rarity">
                        <option value="">–õ—é–±–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å</option>
                        <option value="common">–û–±—ã—á–Ω–æ–µ</option>
                        <option value="uncommon">–ù–µ–æ–±—ã—á–Ω–æ–µ</option>
                        <option value="rare">–†–µ–¥–∫–æ–µ</option>
                        <option value="very rare">–û—á–µ–Ω—å —Ä–µ–¥–∫–æ–µ</option>
                        <option value="legendary">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">–¢–∏–ø –∑–µ–ª—å—è</label>
                    <select class="input-field" id="potion-type">
                        <option value="">–õ—é–±–æ–π —Ç–∏–ø</option>
                        <option value="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ">ü©π –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</option>
                        <option value="–£—Å–∏–ª–µ–Ω–∏–µ">üí™ –£—Å–∏–ª–µ–Ω–∏–µ</option>
                        <option value="–ó–∞—â–∏—Ç–∞">üõ°Ô∏è –ó–∞—â–∏—Ç–∞</option>
                        <option value="–ò–ª–ª—é–∑–∏—è">üëÅÔ∏è –ò–ª–ª—é–∑–∏—è</option>
                        <option value="–¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è">üîÑ –¢—Ä–∞–Ω—Å–º—É—Ç–∞—Ü–∏—è</option>
                        <option value="–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è">üíÄ –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∏—è</option>
                        <option value="–ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ">üîÆ –ü—Ä–æ—Ä–∏—Ü–∞–Ω–∏–µ</option>
                    </select>
                </div>

                <button class="btn" onclick="generatePotion()">
                    üß™ –°–æ–∑–¥–∞—Ç—å –∑–µ–ª—å—è
                </button>
            </div>

            <div id="potion-result" class="card hidden">
                <h3 class="card-title">üß™ –í–∞—à–∏ –∑–µ–ª—å—è</h3>
                <div id="potion-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('potion')">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏
                </button>
            </div>
        </section>

        <!-- –°–∏—Å—Ç–µ–º–∞ –±–æ—è -->
        <section id="combat" class="content-section">
            <div class="card">
                <h2 class="card-title">üó°Ô∏è –°–∏—Å—Ç–µ–º–∞ –±–æ—è</h2>

                <div class="input-group">
                    <label class="input-label">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</label>
                    <input type="text" class="input-field" id="combat-name" placeholder="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞">
                </div>

                <div class="input-group">
                    <label class="input-label">–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞</label>
                    <input type="number" class="input-field" id="combat-initiative" placeholder="–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã">
                </div>

                <button class="btn" onclick="addCombatant()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
                </button>
            </div>

            <div id="combat-list" class="card">
                <h3 class="card-title">üéØ –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã</h3>
                <div id="combat-participants"></div>
                <button class="btn btn-secondary" onclick="nextTurn()">
                    ‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
                </button>
            </div>
        </section>

        <!-- AI –ß–∞—Ç -->
        <section id="ai-chat" class="content-section">
            <div class="card">
                <h2 class="card-title">ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫</h2>

                <div class="input-group">
                    <label class="input-label">–í–∞—à –≤–æ–ø—Ä–æ—Å</label>
                    <textarea class="input-field" id="ai-question" rows="3" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å AI –ø–æ–º–æ—â–Ω–∏–∫—É..."></textarea>
                </div>

                <button class="btn" onclick="askAI()">
                    ü§ñ –°–ø—Ä–æ—Å–∏—Ç—å AI
                </button>
            </div>

            <div id="ai-response" class="card hidden">
                <h3 class="card-title">ü§ñ –û—Ç–≤–µ—Ç AI</h3>
                <div id="ai-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('ai')">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏
                </button>
            </div>
        </section>

        <!-- –ó–∞–º–µ—Ç–∫–∏ -->
        <section id="notes" class="content-section">
            <div class="card">
                <h2 class="card-title">üìù –ó–∞–º–µ—Ç–∫–∏</h2>

                <div class="input-group">
                    <label class="input-label">–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</label>
                    <textarea class="input-field" id="new-note" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..."></textarea>
                </div>

                <button class="btn" onclick="addNote()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
                </button>
            </div>

            <div id="notes-list" class="card">
                <h3 class="card-title">üìã –í–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏</h3>
                <div id="notes-content"></div>
            </div>
        </section>
    </main>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="nav">
        <a href="#" class="nav-item active" onclick="showSection('home')">
            <div class="nav-icon">üè†</div>
            <div>–ì–ª–∞–≤–Ω–∞—è</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('characters')">
            <div class="nav-icon">üë§</div>
            <div>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('enemies')">
            <div class="nav-icon">‚öîÔ∏è</div>
            <div>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('potions')">
            <div class="nav-icon">üß™</div>
            <div>–ó–µ–ª—å—è</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('combat')">
            <div class="nav-icon">üó°Ô∏è</div>
            <div>–ë–æ–π</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('ai-chat')">
            <div class="nav-icon">ü§ñ</div>
            <div>AI</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('notes')">
            <div class="nav-icon">üìù</div>
            <div>–ó–∞–º–µ—Ç–∫–∏</div>
        </a>
    </nav>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentTheme = 'light';
        let currentSection = 'home';
        let combatParticipants = [];
        let currentTurn = 0;
        let notes = JSON.parse(localStorage.getItem('dnd_notes') || '[]');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadNotes();
            updateCombatDisplay();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º
        function cycleTheme() {
            const themes = ['light', 'medium', 'dark', 'mystic'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            setTheme(themes[nextIndex]);
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dnd_theme', theme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('dnd_theme') || 'light';
            setTheme(savedTheme);
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionId).classList.add('active');
            currentSection = sectionId;

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π nav-item
            const navItems = document.querySelectorAll('.nav-item');
            const sectionMap = {
                'home': 0,
                'characters': 1,
                'enemies': 2,
                'potions': 3,
                'combat': 4,
                'ai-chat': 5,
                'notes': 6
            };

            if (sectionMap[sectionId] !== undefined) {
                navItems[sectionMap[sectionId]].classList.add('active');
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        function generateCharacter() {
            const race = document.getElementById('character-race').value;
            const characterClass = document.getElementById('character-class').value;
            const level = document.getElementById('character-level').value;

            if (!race || !characterClass || !level) {
                showModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.');
                return;
            }

            // –í—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            const formData = new FormData();
            formData.append('action', 'generate_character');
            formData.append('race', race);
            formData.append('class', characterClass);
            formData.append('level', level);

            fetch('mobile-api.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCharacter(data.data);
                    } else {
                        showModal('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    showModal('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                });
        }

        function displayCharacter(data) {
            const abilities = data.abilities || {};
            const abilityMods = Object.keys(abilities).map(ability => {
                const mod = Math.floor((abilities[ability] - 10) / 2);
                return `${ability.toUpperCase()}: ${abilities[ability]} (${mod >= 0 ? '+' : ''}${mod})`;
            }).join(', ');

            const content = `
                <div class="character-info">
                    <h4>${data.name}</h4>
                    <p><strong>–†–∞—Å–∞:</strong> ${data.race}</p>
                    <p><strong>–ö–ª–∞—Å—Å:</strong> ${data.class}</p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${data.level}</p>
                    <p><strong>HP:</strong> ${data.hp}</p>
                    <p><strong>AC:</strong> ${data.ac}</p>
                    <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> ${abilityMods}</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${data.description}</p>
                    ${data.features ? `<p><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong> ${data.features.join(', ')}</p>` : ''}
                    ${data.equipment ? `<p><strong>–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ:</strong> ${data.equipment.join(', ')}</p>` : ''}
                    ${data.spells && data.spells.length > 0 ? `<p><strong>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è:</strong> ${data.spells.join(', ')}</p>` : ''}
                </div>
            `;
            
            document.getElementById('character-content').innerHTML = content;
            document.getElementById('character-result').classList.remove('hidden');
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤
        function generateEnemy() {
            const threatLevel = document.getElementById('enemy-threat-level').value;
            const specificCr = document.getElementById('enemy-cr').value;
            const count = parseInt(document.getElementById('enemy-count').value) || 1;
            const enemyType = document.getElementById('enemy-type').value;
            const enemyEnvironment = document.getElementById('enemy-environment').value;
            const useAI = document.getElementById('enemy-use-ai').checked;

            let threatLevelParam = '';
            let message = '';

            if (threatLevel === 'random') {
                threatLevelParam = 'random';
                message = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —É–≥—Ä–æ–∑—ã...';
            } else if (threatLevel) {
                threatLevelParam = threatLevel;
                message = `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —É—Ä–æ–≤–Ω—è "${threatLevel}"...`;
            } else if (specificCr) {
                threatLevelParam = specificCr;
                message = `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —Å CR ${specificCr}...`;
            } else {
                showModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π CR.');
                return;
            }

            if (count < 1 || count > 20) {
                showModal('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 20.');
                return;
            }

            // –í—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            const formData = new FormData();
            formData.append('action', 'generate_enemy');
            formData.append('threat_level', threatLevelParam);
            formData.append('count', count);
            formData.append('enemy_type', enemyType);
            formData.append('environment', enemyEnvironment);
            formData.append('use_ai', useAI ? 'on' : 'off');
            
            showModal(message);

            fetch('mobile-api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayEnemy(data.data);
                    hideModal();
                } else {
                    hideModal();
                    showModal('–û—à–∏–±–∫–∞: ' + (data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                hideModal();
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', error);
                showModal('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            });
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–µ–ª–∏–π
        function generatePotion() {
            const count = parseInt(document.getElementById('potion-count').value) || 1;
            const rarity = document.getElementById('potion-rarity').value;
            const type = document.getElementById('potion-type').value;

            if (count < 1 || count > 10) {
                showModal('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–µ–ª–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10.');
                return;
            }

            showModal('–°–æ–∑–¥–∞–Ω–∏–µ –∑–µ–ª–∏–π...');

            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è API
            const params = new URLSearchParams();
            params.append('action', 'random');
            params.append('count', count);
            if (rarity) params.append('rarity', rarity);
            if (type) params.append('type', type);

            fetch(`api/generate-potions.php?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayPotions(data.data);
                    hideModal();
                } else {
                    hideModal();
                    showModal('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                hideModal();
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–µ–ª–∏–π:', error);
                showModal('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            });
        }
        
        function displayPotions(potions) {
            let content = '<div class="potions-list">';
            
            potions.forEach((potion, index) => {
                const propertiesHtml = potion.properties.map(prop => 
                    `<span class="potion-property">${prop}</span>`
                ).join('');
                
                content += `
                    <div class="potion-item" style="border-left: 4px solid ${potion.color}; margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <div class="potion-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <span class="potion-icon" style="font-size: 24px;">${potion.icon}</span>
                            <h4 style="margin: 0; flex: 1;">${potion.name}</h4>
                            <span class="potion-rarity" style="color: ${potion.color}; font-size: 12px; font-weight: bold; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; border: 1px solid currentColor;">${potion.rarity}</span>
                        </div>
                        <div class="potion-body">
                            <p style="margin: 0 0 15px 0; line-height: 1.5;">${potion.description}</p>
                            <div class="potion-details" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                                <span class="potion-type" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">${potion.icon} ${potion.type}</span>
                                <span class="potion-value" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">üí∞ ${potion.value}</span>
                                <span class="potion-weight" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">‚öñÔ∏è ${potion.weight}</span>
                            </div>
                            <div class="potion-properties" style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${propertiesHtml.split(',').map(prop => 
                                    `<span class="potion-property" style="font-size: 10px; padding: 2px 6px; background: var(--accent-primary); color: white; border-radius: 3px; font-weight: 500;">${prop.trim()}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content += '</div>';
            document.getElementById('potion-content').innerHTML = content;
            document.getElementById('potion-result').classList.remove('hidden');
        }
        
        function displayEnemy(data) {
            if (Array.isArray(data)) {
                // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏
                let content = '<div class="enemies-list">';
                data.forEach((enemy, index) => {
                    content += generateEnemyHTML(enemy, index + 1);
                });
                content += '</div>';
                document.getElementById('enemy-content').innerHTML = content;
            } else {
                // –û–¥–∏–Ω –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫
                document.getElementById('enemy-content').innerHTML = generateEnemyHTML(data);
            }
            
            document.getElementById('enemy-result').classList.remove('hidden');
        }
        
        function generateEnemyHTML(enemy, number = '') {
            const abilities = enemy.abilities || {};
            const abilityMods = Object.keys(abilities).map(ability => {
                const mod = Math.floor((abilities[ability] - 10) / 2);
                return `${ability.toUpperCase()}: ${abilities[ability]} (${mod >= 0 ? '+' : ''}${mod})`;
            }).join(', ');
            
            const actions = Array.isArray(enemy.actions) ? enemy.actions.join(', ') : 
                           (typeof enemy.actions === 'string' ? enemy.actions : '–ê—Ç–∞–∫–∞');
            
            const name = number ? `${enemy.name} ${number}` : enemy.name;
            
            return `
                <div class="enemy-info">
                    <h4>${name}</h4>
                    <p><strong>CR:</strong> ${enemy.challenge_rating || enemy.cr || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    <p><strong>–¢–∏–ø:</strong> ${enemy.type || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    <p><strong>HP:</strong> ${enemy.hit_points || enemy.hp || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    <p><strong>AC:</strong> ${enemy.armor_class || enemy.ac || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    <p><strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> ${enemy.speed || '30 ft'}</p>
                    <p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> ${abilityMods}</p>
                    <p><strong>–î–µ–π—Å—Ç–≤–∏—è:</strong> ${actions}</p>
                    ${enemy.environment ? `<p><strong>–°—Ä–µ–¥–∞:</strong> ${enemy.environment}</p>` : ''}
                    ${enemy.description ? `<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${enemy.description}</p>` : ''}
                    ${enemy.tactics ? `<p><strong>–¢–∞–∫—Ç–∏–∫–∞:</strong> ${enemy.tactics}</p>` : ''}
                </div>
            `;
        }
        
        // –°–∏—Å—Ç–µ–º–∞ –±–æ—è
        function addCombatant() {
            const name = document.getElementById('combat-name').value;
            const initiative = parseInt(document.getElementById('combat-initiative').value) || 0;
            
            if (!name) {
                showModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞.');
                return;
            }
            
            const roll = Math.floor(Math.random() * 20) + 1;
            const totalInitiative = roll + initiative;
            
            combatParticipants.push({
                name: name,
                initiative: totalInitiative,
                roll: roll,
                modifier: initiative
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            combatParticipants.sort((a, b) => b.initiative - a.initiative);
            
            updateCombatDisplay();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('combat-name').value = '';
            document.getElementById('combat-initiative').value = '';
        }
        
        function updateCombatDisplay() {
            const container = document.getElementById('combat-participants');
            
            if (combatParticipants.length === 0) {
                container.innerHTML = '<p class="text-center">–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–æ—è</p>';
                return;
            }
            
            let html = '<ul class="list">';
            combatParticipants.forEach((participant, index) => {
                const isCurrentTurn = index === currentTurn;
                html += `
                    <li class="list-item ${isCurrentTurn ? 'active' : ''}">
                        <div>
                            <strong>${participant.name}</strong>
                            <br>
                            <small>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞: ${participant.initiative} (${participant.roll} + ${participant.modifier})</small>
                        </div>
                        ${isCurrentTurn ? '<span>üéØ</span>' : ''}
                    </li>
                `;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }
        
        function nextTurn() {
            if (combatParticipants.length === 0) return;
            
            currentTurn = (currentTurn + 1) % combatParticipants.length;
            updateCombatDisplay();
        }
        
        // AI –ß–∞—Ç
        function askAI() {
            const question = document.getElementById('ai-question').value;
            
            if (!question.trim()) {
                showModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å.');
                return;
            }
            
            // –í—ã–∑–æ–≤ API –¥–ª—è AI
            const formData = new FormData();
            formData.append('action', 'ai_chat');
            formData.append('question', question);
            
            fetch('mobile-api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayAIResponse(data.data.response);
                } else {
                    showModal('–û—à–∏–±–∫–∞: ' + data.message);
                }
            })
            .catch(error => {
                showModal('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            });
        }
        
        function displayAIResponse(response) {
            document.getElementById('ai-content').innerHTML = `<p>${response}</p>`;
            document.getElementById('ai-response').classList.remove('hidden');
        }
        
        // –ó–∞–º–µ—Ç–∫–∏
        function addNote() {
            const noteText = document.getElementById('new-note').value;
            
            if (!noteText.trim()) {
                showModal('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏.');
                return;
            }
            
            const note = {
                id: Date.now(),
                text: noteText,
                timestamp: new Date().toLocaleString()
            };
            
            notes.unshift(note);
            saveNotes();
            loadNotes();
            
            document.getElementById('new-note').value = '';
        }
        
        function loadNotes() {
            const container = document.getElementById('notes-content');
            
            if (notes.length === 0) {
                container.innerHTML = '<p class="text-center">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</p>';
                return;
            }
            
            let html = '<ul class="list">';
            notes.forEach(note => {
                html += `
                    <li class="list-item">
                        <div>
                            <p>${note.text}</p>
                            <small>${note.timestamp}</small>
                        </div>
                        <button onclick="deleteNote(${note.id})" style="background: var(--accent-danger); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 12px;">√ó</button>
                    </li>
                `;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }
        
        function deleteNote(id) {
            notes = notes.filter(note => note.id !== id);
            saveNotes();
            loadNotes();
        }
        
        function saveNotes() {
            localStorage.setItem('dnd_notes', JSON.stringify(notes));
        }
        
        // –£—Ç–∏–ª–∏—Ç—ã
        function rollDice(dice) {
            const [count, sides] = dice.split('d').map(Number);
            let total = 0;
            let rolls = [];
            
            for (let i = 0; i < count; i++) {
                const roll = Math.floor(Math.random() * sides) + 1;
                rolls.push(roll);
                total += roll;
            }
            
            const result = count === 1 ? rolls[0] : `${rolls.join(', ')} = ${total}`;
            showModal(`üé≤ –ë—Ä–æ—Å–æ–∫ ${dice}: ${result}`);
        }
        
        function generateName(race) {
            const names = {
                human: ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ï–ª–µ–Ω–∞', '–ú–∏—Ö–∞–∏–ª', '–ê–Ω–Ω–∞'],
                elf: ['–õ–µ–≥–æ–ª–∞—Å', '–ì–∞–ª–∞–¥—Ä–∏—ç–ª—å', '–≠–ª—Ä–æ–Ω–¥', '–ê—Ä–≤–µ–Ω'],
                dwarf: ['–ì–∏–º–ª–∏', '–¢–æ—Ä–∏–Ω', '–ë–∞–ª–∏–Ω', '–î–≤–∞–ª–∏–Ω'],
                halfling: ['–ë–∏–ª—å–±–æ', '–§—Ä–æ–¥–æ', '–°—ç–º', '–ü–∏–ø–ø–∏–Ω']
            };
            
            const raceNames = names[race] || names.human;
            return raceNames[Math.floor(Math.random() * raceNames.length)];
        }
        
        function generateEnemyName() {
            const names = ['–ì–æ–±–ª–∏–Ω', '–û—Ä–∫', '–¢—Ä–æ–ª–ª—å', '–î—Ä–∞–∫–æ–Ω', '–ù–µ–∂–∏—Ç—å', '–î–µ–º–æ–Ω'];
            return names[Math.floor(Math.random() * names.length)];
        }
        
        function saveToNotes(type) {
            let content = '';
            
            switch(type) {
                case 'character':
                    content = document.getElementById('character-content').innerText;
                    break;
                case 'enemy':
                    content = document.getElementById('enemy-content').innerText;
                    break;
                case 'ai':
                    content = document.getElementById('ai-content').innerText;
                    break;
                case 'potion':
                    content = document.getElementById('potion-content').innerText;
                    break;
            }
            
            if (content) {
                const note = {
                    id: Date.now(),
                    text: `[${type.toUpperCase()}] ${content}`,
                    timestamp: new Date().toLocaleString()
                };
                
                notes.unshift(note);
                saveNotes();
                loadNotes();
                
                showModal('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∑–∞–º–µ—Ç–∫–∏!');
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('result-modal').classList.add('active');
        }
        
        function hideModal() {
            document.getElementById('result-modal').classList.remove('active');
        }
        
        function closeModal() {
            document.getElementById('result-modal').classList.remove('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById('result-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        

        
        // Haptic feedback –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        if ('vibrate' in navigator) {
            document.querySelectorAll('button, .nav-item').forEach(element => {
                element.addEventListener('click', () => {
                    navigator.vibrate(50);
                });
            });
        }
    </script>
</body>

</html>