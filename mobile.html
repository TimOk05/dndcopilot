<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#a67c52">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DnD Copilot">
    <title>DnD Copilot - Мобильная версия</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">

    <style>
        /* Базовые стили и сброс */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
         :root {
            /* Мобильные размеры */
            --header-height: 60px;
            --nav-height: 50px;
            --content-padding: 16px;
            --border-radius: 12px;
            --border-radius-large: 16px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            /* Типографика */
            --font-primary: 'Roboto', system-ui, sans-serif;
            --font-display: 'UnifrakturCook', serif;
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            /* Тени */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.2);
            /* Z-index */
            --z-header: 1000;
            --z-nav: 900;
            --z-modal: 1100;
            --z-overlay: 1050;
        }
        /* Светлая тема (по умолчанию) */
        
         :root {
            --bg-primary: #f8f4e8;
            --bg-secondary: #fff9f0;
            --bg-tertiary: #f0e6d0;
            --bg-quaternary: #e8dcc0;
            --text-primary: #2d1b00;
            --text-secondary: #4a2e0a;
            --text-tertiary: #7c4a02;
            --border-primary: #a67c52;
            --border-secondary: #8b6b3a;
            --accent-primary: #a67c52;
            --accent-secondary: #7c4a02;
            --accent-success: #2bb07b;
            --accent-warning: #ffd700;
            --accent-danger: #b71c1c;
            --accent-info: #4a90e2;
            --bg-image: url('backgrounds/light-theme.png');
        }
        /* Средняя тема (коричневая) */
        
        [data-theme="medium"] {
            --bg-primary: #2d1810;
            --bg-secondary: #3d2418;
            --bg-tertiary: #4d2a20;
            --bg-quaternary: #5d3028;
            --text-primary: #f0e6d0;
            --text-secondary: #e8dcc0;
            --text-tertiary: #d4c4a0;
            --border-primary: #8b6b3a;
            --border-secondary: #a67c52;
            --accent-primary: #a67c52;
            --accent-secondary: #8b6b3a;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/orange-theme.png');
        }
        /* Тёмная тема */
        
        [data-theme="dark"] {
            --bg-primary: #1a0a0a;
            --bg-secondary: #2a1a1a;
            --bg-tertiary: #3a2a2a;
            --bg-quaternary: #4a3a3a;
            --text-primary: #f0f0f0;
            --text-secondary: #d0d0d0;
            --text-tertiary: #b0b0b0;
            --border-primary: #b71c1c;
            --border-secondary: #d32f2f;
            --accent-primary: #b71c1c;
            --accent-secondary: #d32f2f;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/dark-theme.png');
        }
        /* Мистическая тема */
        
        [data-theme="mystic"] {
            --bg-primary: #1a0a2a;
            --bg-secondary: #2a1a3a;
            --bg-tertiary: #3a2a4a;
            --bg-quaternary: #4a3a5a;
            --text-primary: #f0f0ff;
            --text-secondary: #d0d0ff;
            --text-tertiary: #b0b0ff;
            --border-primary: #7209b7;
            --border-secondary: #8b5cf6;
            --accent-primary: #7209b7;
            --accent-secondary: #8b5cf6;
            --accent-success: #4ade80;
            --accent-warning: #fbbf24;
            --accent-danger: #f87171;
            --accent-info: #60a5fa;
            --bg-image: url('backgrounds/mystic-theme.png');
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        /* Фоновое изображение */
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--bg-image);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1;
            z-index: -1;
        }
        /* Заголовок */
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-md);
            z-index: var(--z-header);
            box-shadow: var(--shadow-sm);
        }
        
        .logo {
            font-family: var(--font-display);
            font-size: var(--text-xl);
            color: var(--text-tertiary);
            font-weight: 700;
        }
        
        .header-controls {
            display: flex;
            gap: var(--spacing-xs);
        }
        
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius);
            padding: var(--spacing-xs) var(--spacing-sm);
            color: var(--text-primary);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: var(--accent-primary);
            color: var(--bg-secondary);
        }
        /* Навигация */
        
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--bg-secondary);
            border-top: 2px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: var(--z-nav);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xs);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--text-xs);
            transition: all 0.3s ease;
            border-radius: var(--border-radius);
        }
        
        .nav-item.active {
            color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .nav-item:hover {
            color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .nav-icon {
            font-size: var(--text-lg);
            margin-bottom: 2px;
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Основной контент */
        
        .main-content {
            margin-top: var(--header-height);
            margin-bottom: var(--nav-height);
            padding: var(--spacing-md);
            min-height: calc(100vh - var(--header-height) - var(--nav-height));
        }
        /* Секции контента */
        
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Карточки */
        
        .card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-large);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-md);
        }
        
        .card-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text-tertiary);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }
        /* Кнопки */
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--text-base);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            width: 100%;
            margin-bottom: var(--spacing-sm);
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-primary);
        }
        
        .btn-secondary:hover {
            background: var(--accent-primary);
            color: var(--bg-secondary);
        }
        /* Поля ввода */
        
        .input-group {
            margin-bottom: var(--spacing-md);
        }
        
        .input-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: var(--text-sm);
        }
        
        .input-field {
            width: 100%;
            padding: var(--spacing-sm);
            background: var(--bg-tertiary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: var(--text-base);
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 3px rgba(166, 124, 82, 0.1);
        }
        /* Списки */
        
        .list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .list-item {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        /* Модальные окна */
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--spacing-md);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-large);
            padding: var(--spacing-lg);
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-primary);
        }
        
        .modal-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--text-tertiary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: var(--accent-danger);
            color: var(--bg-secondary);
        }
        /* Утилиты */
        
        .text-center {
            text-align: center;
        }
        
        .text-left {
            text-align: left;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-sm {
            margin-bottom: var(--spacing-sm);
        }
        
        .mb-md {
            margin-bottom: var(--spacing-md);
        }
        
        .mb-lg {
            margin-bottom: var(--spacing-lg);
        }
        
        .mt-sm {
            margin-top: var(--spacing-sm);
        }
        
        .mt-md {
            margin-top: var(--spacing-md);
        }
        
        .mt-lg {
            margin-top: var(--spacing-lg);
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        /* Анимации */
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-in-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        /* Адаптивность */
        
        @media (max-width: 480px) {
             :root {
                --content-padding: 12px;
                --spacing-lg: 20px;
                --spacing-xl: 28px;
            }
            .card {
                padding: var(--spacing-md);
            }
            .modal-content {
                padding: var(--spacing-md);
            }
        }
        /* Специальные стили для мистической темы */
        
        [data-theme="mystic"] .card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-color: var(--accent-primary);
            box-shadow: 0 4px 20px rgba(114, 9, 183, 0.2);
        }
        
        [data-theme="mystic"] .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            box-shadow: 0 2px 10px rgba(114, 9, 183, 0.3);
        }
        
        [data-theme="mystic"] .btn:hover {
            box-shadow: 0 4px 15px rgba(114, 9, 183, 0.4);
        }
    </style>
</head>

<body>
    <!-- Заголовок -->
    <header class="header">
        <div class="logo">DnD Copilot</div>
        <div class="header-controls">
            <button class="theme-toggle" onclick="cycleTheme()">🎨</button>

        </div>
    </header>

    <!-- Основной контент -->
    <main class="main-content">
        <!-- Главная страница -->
        <section id="home" class="content-section active">
            <div class="card">
                <h2 class="card-title">🎲 Добро пожаловать в DnD Copilot</h2>
                <p class="text-center mb-md">Ваш мобильный помощник для игр D&D</p>

                <div class="btn-group">
                    <button class="btn" onclick="showSection('characters')">
                        👤 Создать персонажа
                    </button>
                    <button class="btn" onclick="showSection('enemies')">
                        ⚔️ Генератор противников
                    </button>
                    <button class="btn" onclick="showSection('potions')">
                        🧪 Генератор зелий
                    </button>
                    <button class="btn" onclick="showSection('combat')">
                        🗡️ Система боя
                    </button>
                    <button class="btn" onclick="showSection('ai-chat')">
                        🤖 AI Помощник
                    </button>
                    <button class="btn" onclick="showSection('notes')">
                        📝 Заметки
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">🎯 Быстрые действия</h3>
                <div class="quick-actions">
                    <button class="btn btn-secondary" onclick="rollDice('1d20')">
                        🎲 1d20
                    </button>
                    <button class="btn btn-secondary" onclick="rollDice('2d6')">
                        🎲 2d6
                    </button>
                    <button class="btn btn-secondary" onclick="rollDice('1d100')">
                        🎲 1d100
                    </button>
                </div>
            </div>
        </section>

        <!-- Генератор персонажей -->
        <section id="characters" class="content-section">
            <div class="card">
                <h2 class="card-title">👤 Генератор персонажей</h2>

                <div class="input-group">
                    <label class="input-label">Раса персонажа</label>
                    <select class="input-field" id="character-race">
                        <option value="">Выберите расу</option>
                        <option value="human">Человек</option>
                        <option value="elf">Эльф</option>
                        <option value="dwarf">Дварф</option>
                        <option value="halfling">Полурослик</option>
                        <option value="orc">Орк</option>
                        <option value="tiefling">Тифлинг</option>
                        <option value="dragonborn">Драконорожденный</option>
                        <option value="gnome">Гном</option>
                        <option value="half-elf">Полуэльф</option>
                        <option value="half-orc">Полуорк</option>
                        <option value="tabaxi">Табакси</option>
                        <option value="aarakocra">Ааракокра</option>
                        <option value="goblin">Гоблин</option>
                        <option value="kenku">Кенку</option>
                        <option value="lizardfolk">Ящеролюд</option>
                        <option value="triton">Тритон</option>
                        <option value="yuan-ti">Юань-ти</option>
                        <option value="goliath">Голиаф</option>
                        <option value="firbolg">Фирболг</option>
                        <option value="bugbear">Багбир</option>
                        <option value="hobgoblin">Хобгоблин</option>
                        <option value="kobold">Кобольд</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Класс персонажа</label>
                    <select class="input-field" id="character-class">
                        <option value="">Выберите класс</option>
                        <option value="fighter">Воин</option>
                        <option value="wizard">Волшебник</option>
                        <option value="rogue">Плут</option>
                        <option value="cleric">Жрец</option>
                        <option value="ranger">Следопыт</option>
                        <option value="barbarian">Варвар</option>
                        <option value="bard">Бард</option>
                        <option value="druid">Друид</option>
                        <option value="monk">Монах</option>
                        <option value="paladin">Паладин</option>
                        <option value="sorcerer">Чародей</option>
                        <option value="warlock">Колдун</option>
                        <option value="artificer">Изобретатель</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Уровень персонажа</label>
                    <select class="input-field" id="character-level">
                        <option value="1">1 уровень</option>
                        <option value="2">2 уровень</option>
                        <option value="3">3 уровень</option>
                        <option value="4">4 уровень</option>
                        <option value="5">5 уровень</option>
                        <option value="6">6 уровень</option>
                        <option value="7">7 уровень</option>
                        <option value="8">8 уровень</option>
                        <option value="9">9 уровень</option>
                        <option value="10">10 уровень</option>
                        <option value="11">11 уровень</option>
                        <option value="12">12 уровень</option>
                        <option value="13">13 уровень</option>
                        <option value="14">14 уровень</option>
                        <option value="15">15 уровень</option>
                        <option value="16">16 уровень</option>
                        <option value="17">17 уровень</option>
                        <option value="18">18 уровень</option>
                        <option value="19">19 уровень</option>
                        <option value="20">20 уровень</option>
                    </select>
                </div>

                <button class="btn" onclick="generateCharacter()">
                    🎲 Создать персонажа
                </button>
            </div>

            <div id="character-result" class="card hidden">
                <h3 class="card-title">👤 Ваш персонаж</h3>
                <div id="character-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('character')">
                    💾 Сохранить в заметки
                </button>
            </div>
        </section>

        <!-- Генератор противников -->
        <section id="enemies" class="content-section">
            <div class="card">
                <h2 class="card-title">⚔️ Генератор противников</h2>

                <div class="input-group">
                    <label class="input-label">Уровень угрозы</label>
                    <select class="input-field" id="enemy-threat-level">
                        <option value="">Выберите уровень угрозы</option>
                        <option value="random">🎲 Случайный</option>
                        <option value="easy">🟢 Легкий (CR 0-3)</option>
                        <option value="medium">🟡 Средний (CR 1-7)</option>
                        <option value="hard">🟠 Сложный (CR 5-12)</option>
                        <option value="deadly">🔴 Смертельный (CR 10-20)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Или конкретный CR</label>
                    <select class="input-field" id="enemy-cr">
                        <option value="">Выберите CR</option>
                        <option value="0">0</option>
                        <option value="0.125">1/8</option>
                        <option value="0.25">1/4</option>
                        <option value="0.5">1/2</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Количество противников</label>
                    <input type="number" class="input-field" id="enemy-count" min="1" max="20" value="1">
                </div>

                <div class="input-group">
                    <label class="input-label">Тип противника (опционально)</label>
                    <input type="text" class="input-field" id="enemy-type" placeholder="например: dragon, undead, beast">
                </div>

                <div class="input-group">
                    <label class="input-label">Среда обитания (опционально)</label>
                    <select class="input-field" id="enemy-environment">
                        <option value="">Любая среда</option>
                        <option value="arctic">Арктическая</option>
                        <option value="coastal">Прибрежная</option>
                        <option value="desert">Пустынная</option>
                        <option value="forest">Лесная</option>
                        <option value="grassland">Равнинная</option>
                        <option value="hill">Холмистая</option>
                        <option value="mountain">Горная</option>
                        <option value="swamp">Болотная</option>
                        <option value="underdark">Подземелье</option>
                        <option value="urban">Городская</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <input type="checkbox" id="enemy-use-ai" checked>
                        Использовать AI для описания и тактики
                    </label>
                </div>

                <button class="btn" onclick="generateEnemy()">
                    🎲 Создать противника
                </button>
            </div>

            <div id="enemy-result" class="card hidden">
                <h3 class="card-title">⚔️ Ваш противник</h3>
                <div id="enemy-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('enemy')">
                    💾 Сохранить в заметки
                </button>
            </div>
        </section>

        <!-- Генератор зелий -->
        <section id="potions" class="content-section">
            <div class="card">
                <h2 class="card-title">🧪 Генератор зелий</h2>

                <div class="input-group">
                    <label class="input-label">Количество зелий</label>
                    <input type="number" class="input-field" id="potion-count" min="1" max="10" value="1">
                </div>

                <div class="input-group">
                    <label class="input-label">Редкость</label>
                    <select class="input-field" id="potion-rarity">
                        <option value="">Любая редкость</option>
                        <option value="common">Обычное</option>
                        <option value="uncommon">Необычное</option>
                        <option value="rare">Редкое</option>
                        <option value="very rare">Очень редкое</option>
                        <option value="legendary">Легендарное</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Тип зелья</label>
                    <select class="input-field" id="potion-type">
                        <option value="">Любой тип</option>
                        <option value="Восстановление">🩹 Восстановление</option>
                        <option value="Усиление">💪 Усиление</option>
                        <option value="Защита">🛡️ Защита</option>
                        <option value="Иллюзия">👁️ Иллюзия</option>
                        <option value="Трансмутация">🔄 Трансмутация</option>
                        <option value="Некромантия">💀 Некромантия</option>
                        <option value="Прорицание">🔮 Прорицание</option>
                    </select>
                </div>

                <button class="btn" onclick="generatePotion()">
                    🧪 Создать зелья
                </button>
            </div>

            <div id="potion-result" class="card hidden">
                <h3 class="card-title">🧪 Ваши зелья</h3>
                <div id="potion-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('potion')">
                    💾 Сохранить в заметки
                </button>
            </div>
        </section>

        <!-- Система боя -->
        <section id="combat" class="content-section">
            <div class="card">
                <h2 class="card-title">🗡️ Система боя</h2>

                <div class="input-group">
                    <label class="input-label">Добавить участника</label>
                    <input type="text" class="input-field" id="combat-name" placeholder="Имя персонажа">
                </div>

                <div class="input-group">
                    <label class="input-label">Инициатива</label>
                    <input type="number" class="input-field" id="combat-initiative" placeholder="Модификатор инициативы">
                </div>

                <button class="btn" onclick="addCombatant()">
                    ➕ Добавить участника
                </button>
            </div>

            <div id="combat-list" class="card">
                <h3 class="card-title">🎯 Порядок инициативы</h3>
                <div id="combat-participants"></div>
                <button class="btn btn-secondary" onclick="nextTurn()">
                    ⏭️ Следующий ход
                </button>
            </div>
        </section>

        <!-- AI Чат -->
        <section id="ai-chat" class="content-section">
            <div class="card">
                <h2 class="card-title">🤖 AI Помощник</h2>

                <div class="input-group">
                    <label class="input-label">Ваш вопрос</label>
                    <textarea class="input-field" id="ai-question" rows="3" placeholder="Задайте вопрос AI помощнику..."></textarea>
                </div>

                <button class="btn" onclick="askAI()">
                    🤖 Спросить AI
                </button>
            </div>

            <div id="ai-response" class="card hidden">
                <h3 class="card-title">🤖 Ответ AI</h3>
                <div id="ai-content"></div>
                <button class="btn btn-secondary" onclick="saveToNotes('ai')">
                    💾 Сохранить в заметки
                </button>
            </div>
        </section>

        <!-- Заметки -->
        <section id="notes" class="content-section">
            <div class="card">
                <h2 class="card-title">📝 Заметки</h2>

                <div class="input-group">
                    <label class="input-label">Новая заметка</label>
                    <textarea class="input-field" id="new-note" rows="3" placeholder="Введите текст заметки..."></textarea>
                </div>

                <button class="btn" onclick="addNote()">
                    ➕ Добавить заметку
                </button>
            </div>

            <div id="notes-list" class="card">
                <h3 class="card-title">📋 Ваши заметки</h3>
                <div id="notes-content"></div>
            </div>
        </section>
    </main>

    <!-- Навигация -->
    <nav class="nav">
        <a href="#" class="nav-item active" onclick="showSection('home')">
            <div class="nav-icon">🏠</div>
            <div>Главная</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('characters')">
            <div class="nav-icon">👤</div>
            <div>Персонажи</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('enemies')">
            <div class="nav-icon">⚔️</div>
            <div>Противники</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('potions')">
            <div class="nav-icon">🧪</div>
            <div>Зелья</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('combat')">
            <div class="nav-icon">🗡️</div>
            <div>Бой</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('ai-chat')">
            <div class="nav-icon">🤖</div>
            <div>AI</div>
        </a>
        <a href="#" class="nav-item" onclick="showSection('notes')">
            <div class="nav-icon">📝</div>
            <div>Заметки</div>
        </a>
    </nav>

    <!-- Модальное окно для результатов -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Результат</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Переменные состояния
        let currentTheme = 'light';
        let currentSection = 'home';
        let combatParticipants = [];
        let currentTurn = 0;
        let notes = JSON.parse(localStorage.getItem('dnd_notes') || '[]');

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadNotes();
            updateCombatDisplay();
        });

        // Переключение тем
        function cycleTheme() {
            const themes = ['light', 'medium', 'dark', 'mystic'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            setTheme(themes[nextIndex]);
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dnd_theme', theme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('dnd_theme') || 'light';
            setTheme(savedTheme);
        }

        // Навигация
        function showSection(sectionId) {
            // Скрываем все секции
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Показываем нужную секцию
            document.getElementById(sectionId).classList.add('active');
            currentSection = sectionId;

            // Обновляем навигацию
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Находим соответствующий nav-item
            const navItems = document.querySelectorAll('.nav-item');
            const sectionMap = {
                'home': 0,
                'characters': 1,
                'enemies': 2,
                'potions': 3,
                'combat': 4,
                'ai-chat': 5,
                'notes': 6
            };

            if (sectionMap[sectionId] !== undefined) {
                navItems[sectionMap[sectionId]].classList.add('active');
            }
        }

        // Генерация персонажей
        function generateCharacter() {
            const race = document.getElementById('character-race').value;
            const characterClass = document.getElementById('character-class').value;
            const level = document.getElementById('character-level').value;

            if (!race || !characterClass || !level) {
                showModal('Пожалуйста, заполните все поля для создания персонажа.');
                return;
            }

            // Вызов API для генерации персонажа
            const formData = new FormData();
            formData.append('action', 'generate_character');
            formData.append('race', race);
            formData.append('class', characterClass);
            formData.append('level', level);

            fetch('mobile-api.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCharacter(data.data);
                    } else {
                        showModal('Ошибка: ' + data.message);
                    }
                })
                .catch(error => {
                    showModal('Ошибка соединения. Попробуйте позже.');
                });
        }

        function displayCharacter(data) {
            const abilities = data.abilities || {};
            const abilityMods = Object.keys(abilities).map(ability => {
                const mod = Math.floor((abilities[ability] - 10) / 2);
                return `${ability.toUpperCase()}: ${abilities[ability]} (${mod >= 0 ? '+' : ''}${mod})`;
            }).join(', ');

            const content = `
                <div class="character-info">
                    <h4>${data.name}</h4>
                    <p><strong>Раса:</strong> ${data.race}</p>
                    <p><strong>Класс:</strong> ${data.class}</p>
                    <p><strong>Уровень:</strong> ${data.level}</p>
                    <p><strong>HP:</strong> ${data.hp}</p>
                    <p><strong>AC:</strong> ${data.ac}</p>
                    <p><strong>Характеристики:</strong> ${abilityMods}</p>
                    <p><strong>Описание:</strong> ${data.description}</p>
                    ${data.features ? `<p><strong>Особенности:</strong> ${data.features.join(', ')}</p>` : ''}
                    ${data.equipment ? `<p><strong>Снаряжение:</strong> ${data.equipment.join(', ')}</p>` : ''}
                    ${data.spells && data.spells.length > 0 ? `<p><strong>Заклинания:</strong> ${data.spells.join(', ')}</p>` : ''}
                </div>
            `;
            
            document.getElementById('character-content').innerHTML = content;
            document.getElementById('character-result').classList.remove('hidden');
        }
        
        // Генерация противников
        function generateEnemy() {
            const threatLevel = document.getElementById('enemy-threat-level').value;
            const specificCr = document.getElementById('enemy-cr').value;
            const count = parseInt(document.getElementById('enemy-count').value) || 1;
            const enemyType = document.getElementById('enemy-type').value;
            const enemyEnvironment = document.getElementById('enemy-environment').value;
            const useAI = document.getElementById('enemy-use-ai').checked;

            let threatLevelParam = '';
            let message = '';

            if (threatLevel === 'random') {
                threatLevelParam = 'random';
                message = 'Генерация случайного уровня угрозы...';
            } else if (threatLevel) {
                threatLevelParam = threatLevel;
                message = `Генерация противника уровня "${threatLevel}"...`;
            } else if (specificCr) {
                threatLevelParam = specificCr;
                message = `Генерация противника с CR ${specificCr}...`;
            } else {
                showModal('Пожалуйста, выберите уровень угрозы или конкретный CR.');
                return;
            }

            if (count < 1 || count > 20) {
                showModal('Количество противников должно быть от 1 до 20.');
                return;
            }

            // Вызов API для генерации противника
            const formData = new FormData();
            formData.append('action', 'generate_enemy');
            formData.append('threat_level', threatLevelParam);
            formData.append('count', count);
            formData.append('enemy_type', enemyType);
            formData.append('environment', enemyEnvironment);
            formData.append('use_ai', useAI ? 'on' : 'off');
            
            showModal(message);

            fetch('mobile-api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayEnemy(data.data);
                    hideModal();
                } else {
                    hideModal();
                    showModal('Ошибка: ' + (data.error || data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(error => {
                hideModal();
                console.error('Ошибка генерации противника:', error);
                showModal('Ошибка соединения. Попробуйте позже.');
            });
        }
        
        // Генерация зелий
        function generatePotion() {
            const count = parseInt(document.getElementById('potion-count').value) || 1;
            const rarity = document.getElementById('potion-rarity').value;
            const type = document.getElementById('potion-type').value;

            if (count < 1 || count > 10) {
                showModal('Количество зелий должно быть от 1 до 10.');
                return;
            }

            showModal('Создание зелий...');

            // Формируем параметры для API
            const params = new URLSearchParams();
            params.append('action', 'random');
            params.append('count', count);
            if (rarity) params.append('rarity', rarity);
            if (type) params.append('type', type);

            fetch(`api/generate-potions.php?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayPotions(data.data);
                    hideModal();
                } else {
                    hideModal();
                    showModal('Ошибка: ' + (data.error || 'Неизвестная ошибка'));
                }
            })
            .catch(error => {
                hideModal();
                console.error('Ошибка генерации зелий:', error);
                showModal('Ошибка соединения. Попробуйте позже.');
            });
        }
        
        function displayPotions(potions) {
            let content = '<div class="potions-list">';
            
            potions.forEach((potion, index) => {
                const propertiesHtml = potion.properties.map(prop => 
                    `<span class="potion-property">${prop}</span>`
                ).join('');
                
                content += `
                    <div class="potion-item" style="border-left: 4px solid ${potion.color}; margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <div class="potion-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <span class="potion-icon" style="font-size: 24px;">${potion.icon}</span>
                            <h4 style="margin: 0; flex: 1;">${potion.name}</h4>
                            <span class="potion-rarity" style="color: ${potion.color}; font-size: 12px; font-weight: bold; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; border: 1px solid currentColor;">${potion.rarity}</span>
                        </div>
                        <div class="potion-body">
                            <p style="margin: 0 0 15px 0; line-height: 1.5;">${potion.description}</p>
                            <div class="potion-details" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                                <span class="potion-type" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">${potion.icon} ${potion.type}</span>
                                <span class="potion-value" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">💰 ${potion.value}</span>
                                <span class="potion-weight" style="padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px;">⚖️ ${potion.weight}</span>
                            </div>
                            <div class="potion-properties" style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${propertiesHtml.split(',').map(prop => 
                                    `<span class="potion-property" style="font-size: 10px; padding: 2px 6px; background: var(--accent-primary); color: white; border-radius: 3px; font-weight: 500;">${prop.trim()}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content += '</div>';
            document.getElementById('potion-content').innerHTML = content;
            document.getElementById('potion-result').classList.remove('hidden');
        }
        
        function displayEnemy(data) {
            if (Array.isArray(data)) {
                // Множественные противники
                let content = '<div class="enemies-list">';
                data.forEach((enemy, index) => {
                    content += generateEnemyHTML(enemy, index + 1);
                });
                content += '</div>';
                document.getElementById('enemy-content').innerHTML = content;
            } else {
                // Один противник
                document.getElementById('enemy-content').innerHTML = generateEnemyHTML(data);
            }
            
            document.getElementById('enemy-result').classList.remove('hidden');
        }
        
        function generateEnemyHTML(enemy, number = '') {
            const abilities = enemy.abilities || {};
            const abilityMods = Object.keys(abilities).map(ability => {
                const mod = Math.floor((abilities[ability] - 10) / 2);
                return `${ability.toUpperCase()}: ${abilities[ability]} (${mod >= 0 ? '+' : ''}${mod})`;
            }).join(', ');
            
            const actions = Array.isArray(enemy.actions) ? enemy.actions.join(', ') : 
                           (typeof enemy.actions === 'string' ? enemy.actions : 'Атака');
            
            const name = number ? `${enemy.name} ${number}` : enemy.name;
            
            return `
                <div class="enemy-info">
                    <h4>${name}</h4>
                    <p><strong>CR:</strong> ${enemy.challenge_rating || enemy.cr || 'Неизвестно'}</p>
                    <p><strong>Тип:</strong> ${enemy.type || 'Неизвестно'}</p>
                    <p><strong>HP:</strong> ${enemy.hit_points || enemy.hp || 'Неизвестно'}</p>
                    <p><strong>AC:</strong> ${enemy.armor_class || enemy.ac || 'Неизвестно'}</p>
                    <p><strong>Скорость:</strong> ${enemy.speed || '30 ft'}</p>
                    <p><strong>Характеристики:</strong> ${abilityMods}</p>
                    <p><strong>Действия:</strong> ${actions}</p>
                    ${enemy.environment ? `<p><strong>Среда:</strong> ${enemy.environment}</p>` : ''}
                    ${enemy.description ? `<p><strong>Описание:</strong> ${enemy.description}</p>` : ''}
                    ${enemy.tactics ? `<p><strong>Тактика:</strong> ${enemy.tactics}</p>` : ''}
                </div>
            `;
        }
        
        // Система боя
        function addCombatant() {
            const name = document.getElementById('combat-name').value;
            const initiative = parseInt(document.getElementById('combat-initiative').value) || 0;
            
            if (!name) {
                showModal('Пожалуйста, введите имя участника.');
                return;
            }
            
            const roll = Math.floor(Math.random() * 20) + 1;
            const totalInitiative = roll + initiative;
            
            combatParticipants.push({
                name: name,
                initiative: totalInitiative,
                roll: roll,
                modifier: initiative
            });
            
            // Сортируем по инициативе (по убыванию)
            combatParticipants.sort((a, b) => b.initiative - a.initiative);
            
            updateCombatDisplay();
            
            // Очищаем поля
            document.getElementById('combat-name').value = '';
            document.getElementById('combat-initiative').value = '';
        }
        
        function updateCombatDisplay() {
            const container = document.getElementById('combat-participants');
            
            if (combatParticipants.length === 0) {
                container.innerHTML = '<p class="text-center">Нет участников боя</p>';
                return;
            }
            
            let html = '<ul class="list">';
            combatParticipants.forEach((participant, index) => {
                const isCurrentTurn = index === currentTurn;
                html += `
                    <li class="list-item ${isCurrentTurn ? 'active' : ''}">
                        <div>
                            <strong>${participant.name}</strong>
                            <br>
                            <small>Инициатива: ${participant.initiative} (${participant.roll} + ${participant.modifier})</small>
                        </div>
                        ${isCurrentTurn ? '<span>🎯</span>' : ''}
                    </li>
                `;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }
        
        function nextTurn() {
            if (combatParticipants.length === 0) return;
            
            currentTurn = (currentTurn + 1) % combatParticipants.length;
            updateCombatDisplay();
        }
        
        // AI Чат
        function askAI() {
            const question = document.getElementById('ai-question').value;
            
            if (!question.trim()) {
                showModal('Пожалуйста, введите вопрос.');
                return;
            }
            
            // Вызов API для AI
            const formData = new FormData();
            formData.append('action', 'ai_chat');
            formData.append('question', question);
            
            fetch('mobile-api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayAIResponse(data.data.response);
                } else {
                    showModal('Ошибка: ' + data.message);
                }
            })
            .catch(error => {
                showModal('Ошибка соединения. Попробуйте позже.');
            });
        }
        
        function displayAIResponse(response) {
            document.getElementById('ai-content').innerHTML = `<p>${response}</p>`;
            document.getElementById('ai-response').classList.remove('hidden');
        }
        
        // Заметки
        function addNote() {
            const noteText = document.getElementById('new-note').value;
            
            if (!noteText.trim()) {
                showModal('Пожалуйста, введите текст заметки.');
                return;
            }
            
            const note = {
                id: Date.now(),
                text: noteText,
                timestamp: new Date().toLocaleString()
            };
            
            notes.unshift(note);
            saveNotes();
            loadNotes();
            
            document.getElementById('new-note').value = '';
        }
        
        function loadNotes() {
            const container = document.getElementById('notes-content');
            
            if (notes.length === 0) {
                container.innerHTML = '<p class="text-center">Нет заметок</p>';
                return;
            }
            
            let html = '<ul class="list">';
            notes.forEach(note => {
                html += `
                    <li class="list-item">
                        <div>
                            <p>${note.text}</p>
                            <small>${note.timestamp}</small>
                        </div>
                        <button onclick="deleteNote(${note.id})" style="background: var(--accent-danger); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 12px;">×</button>
                    </li>
                `;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }
        
        function deleteNote(id) {
            notes = notes.filter(note => note.id !== id);
            saveNotes();
            loadNotes();
        }
        
        function saveNotes() {
            localStorage.setItem('dnd_notes', JSON.stringify(notes));
        }
        
        // Утилиты
        function rollDice(dice) {
            const [count, sides] = dice.split('d').map(Number);
            let total = 0;
            let rolls = [];
            
            for (let i = 0; i < count; i++) {
                const roll = Math.floor(Math.random() * sides) + 1;
                rolls.push(roll);
                total += roll;
            }
            
            const result = count === 1 ? rolls[0] : `${rolls.join(', ')} = ${total}`;
            showModal(`🎲 Бросок ${dice}: ${result}`);
        }
        
        function generateName(race) {
            const names = {
                human: ['Александр', 'Елена', 'Михаил', 'Анна'],
                elf: ['Леголас', 'Галадриэль', 'Элронд', 'Арвен'],
                dwarf: ['Гимли', 'Торин', 'Балин', 'Двалин'],
                halfling: ['Бильбо', 'Фродо', 'Сэм', 'Пиппин']
            };
            
            const raceNames = names[race] || names.human;
            return raceNames[Math.floor(Math.random() * raceNames.length)];
        }
        
        function generateEnemyName() {
            const names = ['Гоблин', 'Орк', 'Тролль', 'Дракон', 'Нежить', 'Демон'];
            return names[Math.floor(Math.random() * names.length)];
        }
        
        function saveToNotes(type) {
            let content = '';
            
            switch(type) {
                case 'character':
                    content = document.getElementById('character-content').innerText;
                    break;
                case 'enemy':
                    content = document.getElementById('enemy-content').innerText;
                    break;
                case 'ai':
                    content = document.getElementById('ai-content').innerText;
                    break;
                case 'potion':
                    content = document.getElementById('potion-content').innerText;
                    break;
            }
            
            if (content) {
                const note = {
                    id: Date.now(),
                    text: `[${type.toUpperCase()}] ${content}`,
                    timestamp: new Date().toLocaleString()
                };
                
                notes.unshift(note);
                saveNotes();
                loadNotes();
                
                showModal('Сохранено в заметки!');
            }
        }
        
        // Модальные окна
        function showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('result-modal').classList.add('active');
        }
        
        function hideModal() {
            document.getElementById('result-modal').classList.remove('active');
        }
        
        function closeModal() {
            document.getElementById('result-modal').classList.remove('active');
        }
        
        // Закрытие модального окна при клике вне его
        document.getElementById('result-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        

        
        // Haptic feedback для мобильных устройств
        if ('vibrate' in navigator) {
            document.querySelectorAll('button, .nav-item').forEach(element => {
                element.addEventListener('click', () => {
                    navigator.vibrate(50);
                });
            });
        }
    </script>
</body>

</html>